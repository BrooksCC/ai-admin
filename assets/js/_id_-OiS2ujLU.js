import{u as h,j as t,b4 as i,b6 as I}from"./index-DL272AWR.js";import{r as M}from"./react-DNsX-D9n.js";import{a as T,b as R,c as A,u as U}from"./menu-CHcegqFY.js";import{S as v}from"./SaveButton-BxXlxv9M.js";import{F as N}from"./FormContainer-BUFgC3wo.js";import{u as f}from"./useForm-CdI9fHK1.js";import{u as C}from"./usePageTransfer-qRKEUqjO.js";import{u as S}from"./useMutation-D-hnmVva.js";import{i as D}from"./isNil-CHIgUVhi.js";import{I as u,F as r,$ as O,H as q,z as w}from"./antd-Bzi-nNZC.js";import"./echarts-C9Czxobr.js";import"./Button-Dt5d1BmR.js";import"./BackButton-BCMBL_tz.js";import"./useWindowSize-CaV-WCuS.js";function P({value:n}){var l;const{t:y}=h(),{data:s}=S({queryKey:["flatMenu"],queryFn:T}),c=D(n)?y("page.systemMenu.topMenu"):(l=s==null?void 0:s.find(d=>d.id===n))==null?void 0:l.title;return t.jsx(u,{value:c,disabled:!0})}function Z(){const{t:n}=h(),{getTransferredData:y}=C(),s=y(),{title:c,isCreateMode:l,isEditMode:d,form:m,formProps:g,isLoading:x,handleSubmit:E}=f({key:"menu",getApiFn:R,createApiFn:A,updateApiFn:U,initialValues:{parentId:s==null?void 0:s.id,title:null,type:null,icon:null,path:null,code:null,description:null,i18nKey:null,sort:0,isShow:!0}}),e=r.useWatch([],m),j=l?s==null?void 0:s.id:e==null?void 0:e.parentId,b=M.useMemo(()=>{const p=[{label:n("page.systemMenu.directory"),value:i.DIRECTORY},{label:n("page.systemMenu.menu"),value:i.MENU},{label:n("page.systemMenu.feature"),value:i.FEATURE}];return l?s!=null&&s.id?s.type===i.DIRECTORY?p.filter(a=>a.value!==i.FEATURE):s.type===i.MENU?p.filter(a=>a.value===i.FEATURE):p:p.filter(a=>a.value!==i.FEATURE):p.filter(a=>a.value===(e==null?void 0:e.type))},[l,s==null?void 0:s.id,s==null?void 0:s.type,e==null?void 0:e.type,n]),o=M.useMemo(()=>{const p={title:[{required:!0,message:n("page.systemMenu.rules.title")}],type:[{required:!0,message:n("page.systemMenu.rules.type")}]};return(e==null?void 0:e.type)===i.MENU?{...p,path:[{required:!0,message:n("page.systemMenu.rules.path")}]}:p},[e==null?void 0:e.type,n]),F=p=>{m.setFieldsValue({icon:null,path:null,code:null}),(p.target.value===i.DIRECTORY||p.target.value===i.FEATURE)&&(m.resetFields(["icon","path","code"]),m.validateFields(["path"]))};return t.jsx(N,{title:c,children:t.jsxs(r,{...g,onFinish:E,children:[t.jsx(r.Item,{label:n("page.systemMenu.parentMenu"),children:t.jsx(P,{value:j})}),t.jsx(r.Item,{label:n("page.systemMenu.title"),name:"title",rules:o.title,children:t.jsx(u,{})}),t.jsx(r.Item,{label:n("page.systemMenu.description"),name:"description",children:t.jsx(u.TextArea,{})}),t.jsx(r.Item,{label:n("page.systemMenu.type"),name:"type",rules:o.type,children:t.jsx(O.Group,{optionType:"button",options:b,disabled:d,onChange:F})}),(e==null?void 0:e.type)&&e.type!==i.FEATURE&&t.jsx(r.Item,{label:n("page.systemMenu.icon"),name:"icon",children:t.jsx(I,{})}),(e==null?void 0:e.type)&&e.type===i.MENU&&t.jsx(r.Item,{label:n("page.systemMenu.path"),name:"path",rules:o==null?void 0:o.path,children:t.jsx(u,{})}),(e==null?void 0:e.type)&&(e.type===i.MENU||e.type===i.FEATURE)&&t.jsx(r.Item,{label:n("page.systemMenu.code"),name:"code",children:t.jsx(u,{})}),(e==null?void 0:e.type)&&(e.type===i.DIRECTORY||e.type===i.MENU)&&t.jsx(r.Item,{label:n("page.systemMenu.i18nKey"),name:"i18nKey",children:t.jsx(u,{})}),t.jsx(r.Item,{label:n("page.systemMenu.sort"),name:"sort",children:t.jsx(q,{min:0,precision:0})}),(e==null?void 0:e.type)===i.MENU&&t.jsx(r.Item,{label:n("page.systemMenu.isShow"),name:"isShow",valuePropName:"checked",children:t.jsx(w,{})}),t.jsx(r.Item,{wrapperCol:{offset:12,span:8},children:t.jsx(v,{type:"primary",loading:x})})]})})}export{Z as default};
