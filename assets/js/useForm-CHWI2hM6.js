import{u as L,a as C}from"./useMutation-DPAUYgD6.js";import{u as P,aM as N}from"./index-B2GpQvlL.js";import{n as D,u as $,r as l}from"./react-DNsX-D9n.js";import{F as z}from"./antd-Bzi-nNZC.js";const B={xs:{span:24},sm:{span:6},md:{span:6},lg:{span:6},xl:{span:6},xxl:{span:6}},I={xs:{span:24},sm:{span:18},md:{span:18},lg:{span:16},xl:{span:14},xxl:{span:12}};function G({key:u,getApiFn:i,createApiFn:F,updateApiFn:b,initialValues:c={},backAfterSuccess:m=!0}){const{t:d}=P(),M=D(),Q=$(),p=N(),[e]=z.useForm(),[q,f]=l.useState(!1),y=`${u}-list`,E=`${u}-detail`,{mode:g,id:s}=M,t=g==="create",o=g==="edit",K=t?d("common.create"):o?d("common.edit"):"",{data:n,isLoading:S}=L({queryKey:[E,s],queryFn:()=>i?i(Number(s)):null,enabled:o&&!!i&&!!s});l.useEffect(()=>{n&&e.setFieldsValue(n)},[n,e]);const x=C({mutationFn:F,onSuccess:()=>{p.invalidateQueries({queryKey:[y]}),m&&r()},onError:a=>{console.log("error",a)}}),v=C({mutationFn:a=>b(Number(s),a),onSuccess:()=>{p.invalidateQueries({queryKey:[y]}),m&&r()},onError:a=>{console.log("error",a)}}),h=async()=>{try{f(!0);const a=await e.validateFields();t?await x.mutateAsync(a):o&&s&&await v.mutateAsync(a)}catch(a){console.log("Form validation failed:",a)}finally{f(!1)}},r=()=>{Q(-1)},w=l.useMemo(()=>({form:e,layout:"horizontal",initialValues:t?c:void 0,labelCol:B,wrapperCol:I,autoComplete:"off"}),[e,t,c]);return{id:s,title:K,isCreateMode:t,isEditMode:o,form:e,formProps:w,detailData:n,isLoading:x.isPending||v.isPending||S||q,handleSubmit:h,handleBack:r}}export{B as a,I as f,G as u};
