import{j as e}from"./index-CrhO62n3.js";import{r as m,u as G}from"./react-DR1zDSRy.js";import{A as f}from"./admin-preset-service-B2Vz9UtJ.js";import{PRESET_TYPE_OPTIONS as C,PRESET_STATUS_OPTIONS as H}from"./types-Ccx87eRq.js";import{G as E,C as M,R as Y,a as y,I as q,d as S,S as k,B as w,w as Q,H as W,J as X,c as Z,s as t,M as $,K as A,f as T,N as ee,i as F,U as B,O as re}from"./antd-BEURTGXr.js";import"./echarts-C5AzJBXJ.js";const{Search:ne}=q,{confirm:O}=$,ae=({onEdit:u,onAdd:x,onImport:N,refreshTrigger:g})=>{const[b,s]=m.useState([]),[c,l]=m.useState(!1),[h,v]=m.useState(0),[a,D]=m.useState({page:1,limit:10}),[o,j]=m.useState([]),d=async()=>{var r;l(!0);try{const n=await f.getAllPresets(a.page??1,a.limit??10,{isActive:a.isActive,nameSearch:a.name,type:a.type}),i=((r=n.items)==null?void 0:r.map(p=>({...p,key:p.id,description:p.description||void 0,tags:p.tags||[]})))||[];s(i),v(n.total||0)}catch(n){t.error("获取预设列表失败"),console.error("Failed to fetch presets:",n)}finally{l(!1)}};m.useEffect(()=>{d()},[a,g]);const L=r=>{O({title:"确定要删除这个预设吗？",icon:e.jsxDEV(A,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:95,columnNumber:13},void 0),content:"此操作不可撤销",onOk:async()=>{try{await f.deletePreset(r),t.success("删除成功"),d()}catch{t.error("删除失败")}}})},_=async r=>{try{await f.copyPreset(r,{name:`Copy of preset ${r.substring(0,4)}`}),t.success("复制成功"),d()}catch{t.error("复制失败")}},z=async(r,n)=>{const i=n?f.unsetAsDefault:f.setAsDefault,p=n?"取消默认":"设为默认";try{await i(r),t.success(`${p}成功`),d()}catch{t.error(`${p}失败`)}},V=r=>{const n={activate:"激活",deactivate:"停用",delete:"删除"};O({title:`确定要批量${n[r]}选中的预设吗？`,icon:e.jsxDEV(A,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:142,columnNumber:13},void 0),onOk:async()=>{try{const i={activate:"activate",deactivate:"deactivate",delete:"delete"};await f.batchOperation({operation:i[r],presetIds:o}),t.success(`批量${n[r]}成功`),j([]),d()}catch{t.error(`批量${n[r]}失败`)}}})},P=(r,n)=>{D(i=>({...i,[r]:n,page:1}))},J=[{title:"ID",dataIndex:"id",key:"id",width:80,render:(r,n)=>e.jsxDEV("a",{onClick:()=>u(n),style:{fontSize:"12px",fontFamily:"monospace"},children:r.slice(-6)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:176,columnNumber:5},void 0)},{title:"名称",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type",render:r=>{var n;return((n=C.find(i=>i.value===r))==null?void 0:n.label)||"未知"}},{title:"状态",dataIndex:"isActive",key:"isActive",render:r=>e.jsxDEV(T,{color:r?"success":"default",children:r?"激活":"停用"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:200,columnNumber:5},void 0)},{title:"默认",dataIndex:"isDefault",key:"isDefault",render:r=>r?e.jsxDEV(T,{color:"blue",children:"是"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:207,columnNumber:49},void 0):"否"},{title:"标签",dataIndex:"tags",key:"tags",render:r=>e.jsxDEV(e.Fragment,{children:r==null?void 0:r.map(n=>e.jsxDEV(T,{children:n},n,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:216,columnNumber:7},void 0))},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:214,columnNumber:5},void 0)},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:r=>new Date(r).toLocaleString()},{title:"操作",key:"action",render:(r,n)=>e.jsxDEV(k,{size:"middle",children:[e.jsxDEV("a",{onClick:()=>u(n),children:"编辑"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:232,columnNumber:11},void 0),e.jsxDEV("a",{onClick:()=>_(n.id),children:"复制"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:233,columnNumber:11},void 0),e.jsxDEV("a",{onClick:()=>L(n.id),children:"删除"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:234,columnNumber:11},void 0),e.jsxDEV("a",{onClick:()=>z(n.id,n.isDefault),children:n.isDefault?"取消默认":"设为默认"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:235,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:231,columnNumber:5},void 0)}],U={selectedRowKeys:o,onChange:r=>j(r)},K=e.jsxDEV(E,{children:[e.jsxDEV(E.Item,{onClick:()=>V("activate"),children:"激活"},"activate",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:250,columnNumber:7},void 0),e.jsxDEV(E.Item,{onClick:()=>V("deactivate"),children:"停用"},"deactivate",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:251,columnNumber:7},void 0),e.jsxDEV(E.Item,{onClick:()=>V("delete"),children:"删除"},"delete",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:252,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:249,columnNumber:3},void 0);return e.jsxDEV(M,{children:[e.jsxDEV(Y,{gutter:[16,16],style:{marginBottom:16},children:[e.jsxDEV(y,{span:8,children:e.jsxDEV(ne,{placeholder:"按名称搜索",onSearch:r=>P("name",r),allowClear:!0},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:260,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:259,columnNumber:9},void 0),e.jsxDEV(y,{span:6,children:e.jsxDEV(S,{placeholder:"按类型过滤",options:C,onChange:r=>P("type",r),style:{width:"100%"},allowClear:!0},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:267,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:266,columnNumber:9},void 0),e.jsxDEV(y,{span:6,children:e.jsxDEV(S,{placeholder:"按状态过滤",options:H,onChange:r=>P("isActive",r),style:{width:"100%"},allowClear:!0},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:276,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:275,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:258,columnNumber:7},void 0),e.jsxDEV(k,{style:{marginBottom:16},children:[e.jsxDEV(w,{type:"primary",icon:e.jsxDEV(Q,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:286,columnNumber:38},void 0),onClick:x,children:"新建预设"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:286,columnNumber:9},void 0),e.jsxDEV(w,{onClick:N,children:"导入预设"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:289,columnNumber:9},void 0),e.jsxDEV(W,{overlay:K,disabled:o.length===0,children:e.jsxDEV(w,{children:["批量操作"," ",e.jsxDEV(X,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:294,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:291,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:290,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:285,columnNumber:7},void 0),e.jsxDEV(Z,{rowSelection:U,columns:J,dataSource:b,loading:c,pagination:{current:a.page,pageSize:a.limit,total:h,onChange:(r,n)=>D(i=>({...i,page:r,limit:n}))}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:298,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetTable.tsx",lineNumber:257,columnNumber:5},void 0)},{Dragger:te}=B,{Paragraph:I}=F,se=[{value:"sillytavern",label:"SillyTavern 格式"},{value:"novelai",label:"NovelAI 格式"},{value:"internal",label:"内部格式 (JSON)"}],ie=({visible:u,onCancel:x,onSuccess:N})=>{const[g,b]=m.useState(!1),[s,c]=m.useState(null),[l,h]=m.useState("internal"),v=async()=>{if(!(s!=null&&s.originFileObj)){t.error("请选择要导入的文件");return}b(!0);try{await f.importPreset(l,s.originFileObj),t.success("导入任务已提交，请稍后刷新列表查看结果"),N(),a()}catch(o){console.error("导入预设失败:",o),t.error("导入预设失败，请检查文件格式或联系管理员")}finally{b(!1)}},a=()=>{c(null),h("internal"),x()},D={name:"file",multiple:!1,accept:".json",fileList:s?[s]:[],beforeUpload:o=>{if(!(o.size/1024/1024<10))return t.error("文件大小不能超过 10MB！"),B.LIST_IGNORE;const d={uid:o.uid||Date.now().toString(),name:o.name,status:"done",originFileObj:o};return c(d),!1},onRemove:()=>{c(null)}};return e.jsxDEV($,{title:"导入预设",open:u,onCancel:a,width:600,footer:[e.jsxDEV(w,{onClick:a,children:"取消"},"cancel",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:106,columnNumber:7},void 0),e.jsxDEV(w,{type:"primary",loading:g,onClick:v,disabled:!s,children:"导入"},"import",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:109,columnNumber:7},void 0)],children:e.jsxDEV(k,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsxDEV(ee,{message:"导入说明",description:e.jsxDEV("div",{children:[e.jsxDEV(I,{children:"• 支持从 SillyTavern, NovelAI 或内部格式的 JSON 文件导入预设。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:125,columnNumber:15},void 0),e.jsxDEV(I,{children:"• 文件大小限制由服务器配置决定 (前端限制为10MB)。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:126,columnNumber:15},void 0),e.jsxDEV(I,{children:"• 如果导入的预设与现有预设名称冲突，系统可能会覆盖或拒绝，具体行为取决于后端配置。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:127,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:124,columnNumber:11},void 0),type:"info",showIcon:!0},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:121,columnNumber:9},void 0),e.jsxDEV(S,{value:l,onChange:h,style:{width:"100%"},options:se},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:134,columnNumber:9},void 0),e.jsxDEV(te,{...D,children:[e.jsxDEV("p",{className:"ant-upload-drag-icon",children:e.jsxDEV(re,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:143,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:142,columnNumber:11},void 0),e.jsxDEV("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:145,columnNumber:11},void 0),e.jsxDEV("p",{className:"ant-upload-hint",children:"支持单个 JSON 文件上传。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:146,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:141,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:120,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/PresetImport.tsx",lineNumber:100,columnNumber:5},void 0)},{Title:me,Paragraph:R}=F,fe=()=>{const u=G(),[x,N]=m.useState(!1),[g,b]=m.useState(0),s=()=>{u("/preset/create")},c=a=>{u(`/preset/${a.id}`)},l=()=>{N(!0)},h=()=>{N(!1)},v=()=>{b(a=>a+1)};return e.jsxDEV("div",{style:{padding:"24px"},children:[e.jsxDEV(k,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsxDEV(M,{children:e.jsxDEV(k,{direction:"vertical",children:[e.jsxDEV(me,{level:2,children:"预设管理"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:46,columnNumber:13},void 0),e.jsxDEV(R,{children:"预设管理用于配置和管理各种类型的AI模型预设，包括聊天预设、指令模板、系统提示等。 您可以创建、编辑、导入和管理不同类型的预设配置。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:47,columnNumber:13},void 0),e.jsxDEV(R,{children:e.jsxDEV("strong",{children:"支持的预设类型："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:52,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:51,columnNumber:13},void 0),e.jsxDEV("ul",{children:[e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"聊天预设："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:56,columnNumber:17},void 0),"用于配置对话格式和序列"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:55,columnNumber:15},void 0),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"文本补全预设："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:60,columnNumber:17},void 0),"用于配置文本生成参数"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:59,columnNumber:15},void 0),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"指令模板："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:64,columnNumber:17},void 0),"用于配置指令格式和模板"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:63,columnNumber:15},void 0),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"上下文模板："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:68,columnNumber:17},void 0),"用于配置上下文处理方式"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:67,columnNumber:15},void 0),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"系统提示："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:72,columnNumber:17},void 0),"用于配置系统级别的提示内容"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:71,columnNumber:15},void 0),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"推理格式："},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:76,columnNumber:17},void 0),"用于配置推理过程的格式化"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:75,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:54,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:45,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:44,columnNumber:9},void 0),e.jsxDEV(ae,{onEdit:c,onAdd:s,onImport:l,refreshTrigger:g},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:84,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:42,columnNumber:7},void 0),e.jsxDEV(ie,{visible:x,onCancel:h,onSuccess:v},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:93,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/index.tsx",lineNumber:41,columnNumber:5},void 0)};export{fe as default};
