import{u as O,j as t}from"./index-BpF1OpJE.js";import{r as d}from"./react-DNsX-D9n.js";import{A as j}from"./admin-service-CzzxyH7d.js";import{C as H}from"./CreateButton-BQmwzpaj.js";import{E as Q}from"./EditButton-B8i7R0FJ.js";import{S as U,a as v,b as W,R as X}from"./SearchRow-BsstOlnZ.js";import{S as Z}from"./SearchContainer-DAc_9fY5.js";import{u as ee,a as te,S as se}from"./useTable-DIwiu8V3.js";import{l as re,B as u,N as le,A as ae,F as r,a as E,I as a,o as ne,K as w,g as F,S as n,z as A}from"./antd-Bzi-nNZC.js";import"./echarts-C9Czxobr.js";import"./Button-DSSUBtr-.js";import"./useWindowSize-CaV-WCuS.js";import"./useMutation-DiyeizWV.js";import"./usePageTransfer-fEii5zoy.js";function ie({noText:e,...f}){const{t:l}=O();return t.jsx(re,{title:e?l("重新加载"):"",children:t.jsx(u,{icon:t.jsx(le,{}),...f,children:!e&&l("重新加载")})})}function ke(){const{t:e}=O(),f=d.useRef(null),{message:l}=ae.useApp(),[R,m]=d.useState(!1),[T,h]=d.useState(!1),[y]=r.useForm(),[g]=r.useForm(),[S,o]=d.useState(!1),[b,q]=d.useState(null);d.useEffect(()=>{const s=localStorage.getItem("user.token");console.log("当前token状态:",s?"已存在":"不存在",s?`${s.substring(0,15)}...`:"")},[]);async function P({page:s,pageSize:i,category:k}){console.log("正在请求配置列表...",{page:s,pageSize:i,category:k});try{const c=await j.getAllSettings(k),C=(s-1)*i,z=C+i,I=c.slice(C,z);return console.log("配置列表获取成功:",I),{list:I,total:c.length}}catch(c){return console.error("获取配置列表失败:",c),c instanceof Error?l.error(`获取配置列表失败: ${c.message}`):l.error("获取配置列表失败: 未知错误"),{list:[],total:0}}}const{listContainerProps:B,tableScrollY:M}=ee(),N=s=>{if(s==null)return"-";if(typeof s=="boolean")return e(s?"是":"否");try{return JSON.stringify(s)}catch{return String(s)}},{form:p,tableProps:V,isLoading:_,handleReset:J,refetch:x}=te({key:"settings-list",pagination:!0,listApiFn:P,scrollY:M,selectable:!1,formInitialValues:{key:null,category:null},columns:[{title:e("配置键名"),dataIndex:"key",width:200},{title:e("配置值"),dataIndex:"value",render:N,ellipsis:!0},{title:e("值类型"),dataIndex:"type",width:100},{title:e("描述"),dataIndex:"description",ellipsis:!0},{title:e("分类"),dataIndex:"category",width:120},{title:e("系统配置"),dataIndex:"isSystem",render:s=>e(s?"是":"否"),width:100},{title:e("操作"),key:"actions",fixed:"right",width:120,render:(s,i)=>t.jsx(E,{children:t.jsx(Q,{type:"text",size:"small",noText:!0,onClick:()=>D(i)})})}]}),L=async()=>{try{o(!0),await j.reloadSettings(),l.success(e("配置已重新加载")),x()}catch(s){console.error("重新加载配置失败:",s),l.error(e("重新加载配置失败"))}finally{o(!1)}};function D(s){q(s),g.setFieldsValue({key:s.key,value:s.value,type:s.type,description:s.description,category:s.category,isSystem:s.isSystem}),h(!0)}async function Y(){try{if(!b)return;const s=await g.validateFields();o(!0);const i={value:s.value};await j.updateSetting(b.key,i),l.success(e("更新成功")),h(!1),x()}catch(s){console.error("更新配置失败:",s),l.error(e("更新失败"))}finally{o(!1)}}function $(){y.resetFields(),m(!0)}async function G(){try{const s=await y.validateFields();o(!0);const i={key:s.key,value:s.value,type:s.type,description:s.description,category:s.category,isSystem:s.isSystem||!1};await j.createSetting(i),l.success(e("创建成功")),m(!1),x()}catch(s){console.error("创建配置失败:",s),l.error(e("创建失败"))}finally{o(!1)}}const K=t.jsx(r,{ref:f,form:p,colon:!1,autoComplete:"off",onFinish:()=>x(),children:t.jsx(Z,{actions:t.jsxs(E,{children:[t.jsx(W,{loading:_,onClick:()=>p.submit()}),t.jsx(X,{onClick:J}),t.jsx(H,{onClick:$}),t.jsx(ie,{onClick:L,loading:S})]}),children:t.jsxs(U,{children:[t.jsx(v,{name:"key",label:e("配置键名"),children:t.jsx(a,{onPressEnter:()=>p.submit()})}),t.jsx(v,{name:"category",label:e("分类"),children:t.jsx(a,{onPressEnter:()=>p.submit()})})]})})});return t.jsxs(t.Fragment,{children:[t.jsx(se,{...B,searchForm:K,children:t.jsx(ne,{...V,locale:{emptyText:t.jsx(w,{description:e("暂无配置数据"),image:w.PRESENTED_IMAGE_SIMPLE})}})}),t.jsx(F,{title:e("创建配置"),open:R,onCancel:()=>m(!1),footer:[t.jsx(u,{onClick:()=>m(!1),children:e("取消")},"cancel"),t.jsx(u,{type:"primary",loading:S,onClick:G,children:e("确定")},"submit")],children:t.jsxs(r,{form:y,layout:"vertical",autoComplete:"off",initialValues:{isSystem:!1,type:"string"},children:[t.jsx(r.Item,{name:"key",label:e("配置键名"),rules:[{required:!0,message:e("请输入配置键名")}],children:t.jsx(a,{placeholder:e("例如: site.name")})}),t.jsx(r.Item,{name:"value",label:e("配置值"),rules:[{required:!0,message:e("请输入配置值")}],children:t.jsx(a.TextArea,{rows:3,placeholder:e("请输入配置值")})}),t.jsx(r.Item,{name:"type",label:e("值类型"),rules:[{required:!0,message:e("请选择值类型")}],children:t.jsxs(n,{placeholder:e("请选择值类型"),children:[t.jsx(n.Option,{value:"string",children:e("字符串")}),t.jsx(n.Option,{value:"number",children:e("数字")}),t.jsx(n.Option,{value:"boolean",children:e("布尔值")}),t.jsx(n.Option,{value:"json",children:e("JSON对象")})]})}),t.jsx(r.Item,{name:"description",label:e("描述"),children:t.jsx(a,{placeholder:e("请输入描述")})}),t.jsx(r.Item,{name:"category",label:e("分类"),rules:[{required:!0,message:e("请输入分类")}],children:t.jsx(a,{placeholder:e("例如: general, api_keys")})}),t.jsx(r.Item,{name:"isSystem",label:e("系统配置"),valuePropName:"checked",children:t.jsx(A,{})})]})}),t.jsx(F,{title:e("编辑配置"),open:T,onCancel:()=>h(!1),footer:[t.jsx(u,{onClick:()=>h(!1),children:e("取消")},"cancel"),t.jsx(u,{type:"primary",loading:S,onClick:Y,children:e("确定")},"submit")],children:t.jsxs(r,{form:g,layout:"vertical",autoComplete:"off",children:[t.jsx(r.Item,{name:"key",label:e("配置键名"),children:t.jsx(a,{disabled:!0})}),t.jsx(r.Item,{name:"value",label:e("配置值"),rules:[{required:!0,message:e("请输入配置值")}],children:t.jsx(a.TextArea,{rows:3,placeholder:e("请输入配置值")})}),t.jsx(r.Item,{name:"type",label:e("值类型"),rules:[{required:!0,message:e("请选择值类型")}],children:t.jsxs(n,{placeholder:e("请选择值类型"),children:[t.jsx(n.Option,{value:"string",children:e("字符串")}),t.jsx(n.Option,{value:"number",children:e("数字")}),t.jsx(n.Option,{value:"boolean",children:e("布尔值")}),t.jsx(n.Option,{value:"json",children:e("JSON对象")})]})}),t.jsx(r.Item,{name:"description",label:e("描述"),children:t.jsx(a,{placeholder:e("请输入描述")})}),t.jsx(r.Item,{name:"category",label:e("分类"),rules:[{required:!0,message:e("请输入分类")}],children:t.jsx(a,{placeholder:e("例如: general, api_keys")})}),t.jsxs(r.Item,{name:"isSystem",label:e("系统配置"),valuePropName:"checked",children:[t.jsx(A,{disabled:!0})," "]})]})})]})}export{ke as default};
