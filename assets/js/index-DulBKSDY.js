import{u as D,j as n}from"./index-DRQO0BkJ.js";import{r as u,L as C}from"./react-DR1zDSRy.js";import{s as j}from"./admin-B6zCYbDp.js";import{u as V,a as S,S as T}from"./useTable-RyDLZMBK.js";import{A as L,c as P,E as N,k as g,d as A}from"./antd-Sq0EuMdw.js";import"./echarts-C5AzJBXJ.js";import"./admin-service-BUpGHG4_.js";import"./useWindowSize-ncjCtajF.js";import"./useMutation-Bbwrbsjq.js";import"./usePageTransfer-BkoxjU5-.js";const F=[{label:"等级 1",value:1},{label:"等级 2",value:2},{label:"等级 3",value:3}],R=[{label:"User",value:"user"},{label:"Admin",value:"admin"}];function H(){const{t:i}=D(),{message:d}=L.useApp(),p=u.useRef(null),[m,b]=u.useState({});u.useEffect(()=>{const r=localStorage.getItem("user.token");console.log("当前token状态:",r?"已存在":"不存在",r?`${r.substring(0,15)}...`:"")},[]);const l=(r,e,a)=>({filterDropdown:({setSelectedKeys:t,selectedKeys:s,confirm:c,clearFilters:v})=>n.jsxDEV("div",{style:{padding:8},onKeyDown:o=>o.stopPropagation(),children:[a?n.jsxDEV(A,{placeholder:e,value:s[0],onChange:o=>t(o===void 0?[]:[o]),style:{marginBottom:8,display:"block",width:188},allowClear:!0,options:a},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:57,columnNumber:7},this):n.jsxDEV("input",{ref:p,placeholder:e,value:s[0]||"",onChange:o=>t(o.target.value?[o.target.value]:[]),onKeyDown:o=>{o.key==="Enter"&&h(s,c,r)},style:{marginBottom:8,display:"block",width:188,padding:"4px 11px",border:"1px solid #d9d9d9",borderRadius:"6px"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:67,columnNumber:7},this),n.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between"},children:[n.jsxDEV("button",{type:"button",onClick:()=>h(s,c,r),style:{width:90,height:32,backgroundColor:"#1890ff",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:[n.jsxDEV(g,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:94,columnNumber:13},this)," "," ",i("过滤")]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:81,columnNumber:11},this),n.jsxDEV("button",{type:"button",onClick:()=>v&&k(v,c,r),style:{width:90,height:32,backgroundColor:"#f5f5f5",color:"#666",border:"1px solid #d9d9d9",borderRadius:"6px",cursor:"pointer"},children:i("重置")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:99,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:80,columnNumber:9},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:54,columnNumber:5},this),filterIcon:t=>n.jsxDEV(g,{style:{color:t?"#1890ff":void 0}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:118,columnNumber:5},this),onFilterDropdownOpenChange:t=>{t&&!a&&setTimeout(()=>{var s;return(s=p.current)==null?void 0:s.select()},100)}}),h=(r,e,a)=>{e();const t={...m,[a]:r[0]};b(t),setTimeout(()=>{f()},0)},k=(r,e,a)=>{r(),e();const t={...m};delete t[a],b(t),setTimeout(()=>{f()},0)},w=u.useCallback(async r=>{const e={...r,...m};console.log("正在请求用户列表 (via useCallback)...",e);const a={userId:e.userId&&typeof e.userId=="string"&&e.userId.trim()!==""?e.userId.trim():void 0,nickname:e.nickname&&typeof e.nickname=="string"&&e.nickname.trim()!==""?e.nickname.trim():void 0,email:e.email&&typeof e.email=="string"&&e.email.trim()!==""?e.email.trim():void 0,level:e.level!==void 0&&e.level!==null&&e.level!==""?Number(e.level):void 0,roleName:e.roleName&&typeof e.roleName=="string"&&e.roleName.trim()!==""?e.roleName.trim():void 0};console.log("清理后的搜索参数 (via useCallback):",a);try{const t=await j(e.page,e.pageSize,a.userId,a.nickname,a.email,a.level,a.roleName);return console.log("用户列表获取成功 (via useCallback):",t),{list:t.items||[],total:t.total||0}}catch(t){return console.error("获取用户列表失败 (via useCallback):",t),t instanceof Error?d.error(`获取用户列表失败: ${t.message}`):d.error("获取用户列表失败: 未知错误"),{list:[],total:0}}},[m,d]),{listContainerProps:y,tableScrollY:x}=V(),{tableProps:E,isLoading:I,refetch:f}=S({key:"user-list",pagination:!0,listApiFn:w,scrollY:x,formInitialValues:{userId:void 0,nickname:void 0,email:void 0,level:void 0,roleName:void 0},columns:[{title:i("用户ID"),dataIndex:"id",width:280,render:r=>n.jsxDEV(C,{to:`/user/${r}`,children:r},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:239,columnNumber:31},this),key:"id",...l("userId",i("请输入用户ID"))},{title:i("昵称"),dataIndex:"nickname",key:"nickname",width:150,...l("nickname",i("请输入昵称"))},{title:i("邮箱"),dataIndex:"email",key:"email",width:200,...l("email",i("请输入邮箱"))},{title:i("等级"),dataIndex:"level",key:"level",width:80,...l("level",i("请选择等级"),F)},{title:i("角色"),dataIndex:"roles",key:"roles",width:150,render:r=>!r||r.length===0?"-":r.map(e=>e.name).join(", "),...l("roleName",i("请选择角色"),R)},{title:i("注册时间"),dataIndex:"createdAt",key:"createdAt",width:180,render:r=>new Date(r).toLocaleString()}]});return n.jsxDEV(n.Fragment,{children:n.jsxDEV(T,{...y,children:n.jsxDEV(P,{...E,loading:I,locale:{emptyText:n.jsxDEV(N,{description:i("暂无用户数据"),image:N.PRESENTED_IMAGE_SIMPLE},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:293,columnNumber:24},this)},scroll:{x:1200,y:x}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:289,columnNumber:9},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:288,columnNumber:7},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/user/index.tsx",lineNumber:287,columnNumber:5},this)}export{H as default};
