import{u as h,j as e}from"./index-bnCn0n-D.js";import{r as y}from"./react-Dz_Dwpfc.js";import{a as E,b as F,c as f,u as v}from"./api-DBj2u7Du.js";import{S as C}from"./SaveButton-DDFjKMU4.js";import{F as S}from"./FormContainer-CKXckZNH.js";import{A as p,a as r}from"./api-DqxKD7_o.js";import{u as q}from"./useForm-DSJJ98Ou.js";import{u as D}from"./usePageTransfer-Bi3KoAVq.js";import{u as O}from"./useMutation-B-lWSa9s.js";import{i as M}from"./isNil-CHIgUVhi.js";import{I as l,F as i,Q as R,S as N,r as G}from"./antd-BKYABR1U.js";import"./echarts-C9Czxobr.js";import"./Button-BQVmhETS.js";import"./useWindowSize-DSNN33pu.js";function H({value:t}){var n;const{t:m}=h(),{data:a}=O({queryKey:["flatMenu"],queryFn:E}),u=M(t)?m("page.systemApi.topApi"):(n=a==null?void 0:a.find(d=>d.id===t))==null?void 0:n.title;return e.jsx(l,{value:u,disabled:!0})}function $(){const{t}=h(),{getTransferredData:m}=D(),a=m(),{title:u,isCreateMode:n,isEditMode:d,form:c,formProps:g,isLoading:x,handleSubmit:j}=q({key:"api",getApiFn:F,createApiFn:f,updateApiFn:v,initialValues:{parentId:a==null?void 0:a.id,title:null,type:null,path:null,method:null,code:null,description:null,sort:0}}),s=i.useWatch([],c),I=n?a==null?void 0:a.id:s==null?void 0:s.parentId,b=y.useMemo(()=>[{label:t("page.systemApi.directory"),value:p.DIRECTORY},{label:t("page.systemApi.api"),value:p.API}],[t]),T=[{label:"GET",value:r.GET},{label:"POST",value:r.POST},{label:"PUT",value:r.PUT},{label:"PATCH",value:r.PATCH},{label:"DELETE",value:r.DELETE}],o=y.useMemo(()=>{const A={title:[{required:!0,message:t("page.systemApi.rules.title")}],type:[{required:!0,message:t("page.systemApi.rules.type")}]};return(s==null?void 0:s.type)===p.API?{...A,path:[{required:!0,message:t("page.systemApi.rules.path")}],method:[{required:!0,message:t("page.systemApi.rules.method")}]}:A},[s==null?void 0:s.type,t]),P=()=>{c.setFieldsValue({method:null,path:null,code:null})};return e.jsx(S,{title:u,children:e.jsxs(i,{...g,onFinish:j,children:[e.jsx(i.Item,{label:t("page.systemApi.parentApi"),children:e.jsx(H,{value:I})}),e.jsx(i.Item,{label:t("page.systemApi.title"),name:"title",rules:o.title,children:e.jsx(l,{})}),e.jsx(i.Item,{label:t("page.systemApi.description"),name:"description",children:e.jsx(l.TextArea,{})}),e.jsx(i.Item,{label:t("page.systemApi.type"),name:"type",rules:o.type,children:e.jsx(R.Group,{optionType:"button",options:b,disabled:d,onChange:P})}),(s==null?void 0:s.type)===p.API&&e.jsx(i.Item,{label:t("page.systemApi.path"),name:"path",rules:o.path,children:e.jsx(l,{})}),(s==null?void 0:s.type)===p.API&&e.jsx(i.Item,{label:t("page.systemApi.method"),name:"method",rules:o.method,children:e.jsx(N,{options:T,allowClear:!0})}),(s==null?void 0:s.type)===p.API&&e.jsx(i.Item,{label:t("page.systemApi.code"),name:"code",children:e.jsx(l,{})}),e.jsx(i.Item,{label:t("page.systemApi.sort"),name:"sort",children:e.jsx(G,{min:0,precision:0})}),e.jsx(i.Item,{wrapperCol:{offset:12,span:8},children:e.jsx(C,{type:"primary",loading:x})})]})})}export{$ as default};
