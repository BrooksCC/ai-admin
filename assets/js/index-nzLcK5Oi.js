import{j as e,D as Ne,d as be}from"./index-7HAhTflM.js";import{r as g,e as je,u as Ve}from"./react-DR1zDSRy.js";import{d as J,B as P,a6 as Se,a7 as de,h as ae,F as M,e as we,M as ne,I as Ee,s as B,k as Te,i as Ae}from"./antd-C5ilffvX.js";import{B as he}from"./Button--7aMwg8B.js";import{a as xe,g as Ce,u as Ie}from"./character-BdxRh0j_.js";import{A as Re}from"./admin-service-Unq2esHp.js";import"./echarts-C5AzJBXJ.js";const Oe=({value:r=[],onChange:n})=>{const[i,o]=g.useState(""),[d,E]=g.useState(""),b=Array.isArray(r)?r:[];g.useEffect(()=>{b.length>0&&!i&&(o(b[0]),E(b[0]))},[b,i]);const u=m=>{o(m),E(m)},f=m=>{E(m.target.value)},I=()=>{if(!d.trim()||!n)return;const m=[...b],p=m.indexOf(i),h=[...m];p>=0?h[p]=d:h.push(d),n(h),o(""),E("")},R=m=>{if(!n)return;const p=b.filter(h=>h!==m);n(p),i===m&&(o(""),E(""))};return e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("div",{className:"mb-2",children:e.jsxDEV(J,{placeholder:"选择要编辑的问候语或创建新问候语",onChange:u,value:i,allowClear:!0,style:{width:"100%"},options:b.map(m=>({label:e.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxDEV("span",{style:{flexGrow:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.length>25?`${m.substring(0,25)}...`:m},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:82,columnNumber:33},void 0),e.jsxDEV(P,{type:"text",danger:!0,icon:e.jsxDEV(Se,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:88,columnNumber:23},void 0),onClick:p=>{p.stopPropagation(),R(m)},size:"small",style:{marginLeft:"8px"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:85,columnNumber:33},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:81,columnNumber:13},void 0),value:m}))},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:73,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:72,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-2",children:e.jsxDEV(de,{value:d,onChange:f,autoSize:{minRows:1,maxRows:15},placeholder:"编辑问候语内容"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:104,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:103,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex justify-end",children:e.jsxDEV(P,{type:"primary",size:"small",onClick:I,disabled:!d.trim(),children:i?"更新问候语":"添加问候语"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:113,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:112,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/GreetingsEditor.tsx",lineNumber:71,columnNumber:5},void 0)},{Text:se}=ae,Me=({character:r,renderFormItem:n,handleAuditCharacter:i,auditing:o,handleFormChange:d})=>r?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"p-4 bg-rose-50 rounded-md mb-4 border border-rose-200",children:e.jsxDEV(se,{type:"danger",children:"此区域用于审核角色信息。请确认所有内容符合社区规范和平台政策。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:27,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:26,columnNumber:13},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxDEV("div",{className:"col-span-1",children:e.jsxDEV("div",{className:"aspect-square overflow-hidden rounded-lg mb-4 border-2 border-rose-300",children:e.jsxDEV("img",{src:r.avatarUrl,alt:r.name,className:"w-full h-full object-cover",style:{filter:r.shouldBlurAvatar?"blur(8px)":"none"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:34,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:33,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:32,columnNumber:17},void 0),e.jsxDEV("div",{className:"col-span-2",children:[n("avatarUrl","角色头像URL"),n("visibility","可见性","select"),n("characterVersion","角色版本"),e.jsxDEV("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200 mb-4",children:[e.jsxDEV(se,{strong:!0,children:"审核状态: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:51,columnNumber:25},void 0),e.jsxDEV(se,{type:r.auditStatus==="approved"?"success":r.auditStatus==="rejected"?"danger":"warning",children:r.auditStatus==="approved"?"已通过":r.auditStatus==="rejected"?"已拒绝":r.auditStatus==="pending"?"待审核":"无审核状态"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:52,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:50,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[e.jsxDEV("div",{className:"font-normal text-base",children:"模糊显示头像"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:67,columnNumber:25},void 0),e.jsxDEV(M.Item,{name:"shouldBlurAvatar",valuePropName:"checked",className:"mb-0",style:{marginBottom:0},children:e.jsxDEV(we,{onChange:d},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:74,columnNumber:29},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:68,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:66,columnNumber:21},void 0),e.jsxDEV("div",{className:"mt-4 flex justify-end",children:[e.jsxDEV(P,{type:"primary",danger:!0,className:"mr-2",onClick:()=>i(!1),loading:o,children:"拒绝"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:79,columnNumber:25},void 0),e.jsxDEV(P,{type:"primary",onClick:()=>i(!0),loading:o,children:"通过审核"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:88,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:78,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:44,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:31,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ReviewTab.tsx",lineNumber:25,columnNumber:5},void 0):null;var ke;let De;function Ge(r,n,i,o,d,E){var b,u,f,I,R,m,p,h=Symbol.metadata||Symbol.for("Symbol.metadata"),x=Object.defineProperty,G=Object.create,L=[G(null),G(null)],z=n.length;function T(t,j,V){return function(l,N){j&&(N=l,l=r);for(var A=0;A<t.length;A++)N=t[A].apply(l,V?[N]:[]);return V?N:l}}function v(t,j,V,l){if(typeof t!="function"&&(l||t!==void 0))throw new TypeError(j+" must "+(V||"be")+" a function"+(l?"":" or undefined"));return t}function W(t,j,V,l,N,A,K,w,a,s,c){function k(y){if(!c(y))throw new TypeError("Attempted to access private element on non-instance")}var O=[].concat(j[0]),_=j[3],q=!K,Y=N===1,ce=N===3,ue=N===4,Q=N===2;function X(y,F,pe){return function(ee,fe){return F&&(fe=ee,ee=t),pe&&pe(ee),D[y].call(ee,fe)}}if(!q){var D={},ie=[],$=ce?"get":ue||Y?"set":"value";if(a?(s||Y?D={get:ge(function(){return _(this)},l,"get"),set:function(y){j[4](this,y)}}:D[$]=_,s||ge(D[$],l,Q?"":$)):s||(D=Object.getOwnPropertyDescriptor(t,l)),!s&&!a){if((u=L[+w][l])&&(u^N)!=7)throw Error("Decorating two elements with the same name ("+D[$].name+") is not supported yet");L[+w][l]=N<3?1:N}}for(var S=t,Z=O.length-1;Z>=0;Z-=V?2:1){var me=v(O[Z],"A decorator","be",!0),le=V?O[Z-1]:void 0,te={},H={kind:["field","accessor","method","getter","setter","class"][N],name:l,metadata:b,addInitializer:(function(y,F){if(y.v)throw new TypeError("attempted to call addInitializer after decoration was finished");v(F,"An initializer","be",!0),A.push(F)}).bind(null,te)};if(q)u=me.call(le,S,H),te.v=1,v(u,"class decorators","return")&&(S=u);else if(H.static=w,H.private=a,u=H.access={has:a?c.bind():function(y){return l in y}},ue||(u.get=a?Q?function(y){return k(y),D.value}:X("get",0,k):function(y){return y[l]}),Q||ce||(u.set=a?X("set",0,k):function(y,F){y[l]=F}),S=me.call(le,Y?{get:D.get,set:D.set}:D[$],H),te.v=1,Y){if(typeof S=="object"&&S)(u=v(S.get,"accessor.get"))&&(D.get=u),(u=v(S.set,"accessor.set"))&&(D.set=u),(u=v(S.init,"accessor.init"))&&ie.unshift(u);else if(S!==void 0)throw new TypeError("accessor decorators must return an object with get, set, or init properties or undefined")}else v(S,(s?"field":"method")+" decorators","return")&&(s?ie.unshift(S):D[$]=S)}return N<2&&K.push(T(ie,w,1),T(A,w,0)),s||q||(a?Y?K.splice(-1,0,X("get",w),X("set",w)):K.push(Q?D[$]:v.call.bind(D[$])):x(t,l,D)),S}function U(t){return x(t,h,{configurable:!0,enumerable:!0,value:b})}return b=G(b??null),R=[],m=function(t){t&&R.push(T(t))},p=function(t,j){for(var V=0;V<i.length;V++){var l=i[V],N=l[1],A=7&N;if((8&N)==t&&!A==j){var K=l[2],w=!!l[3],a=16&N;W(t?r:r.prototype,l,a,w?"#"+K:Ke(K),A,A<2?[]:t?I=I||[]:f=f||[],R,!!t,w,j,t&&w?function(s){return $e(s)===r}:d)}}},p(8,0),p(0,0),p(8,1),p(0,1),m(f),m(I),u=R,z||U(r),{e:u,get c(){var t=[];return z&&[U(r=W(r,[n],o,r.name,5,t)),T(t,1)]}}}function Ke(r){var n=_e(r,"string");return typeof n=="symbol"?n:n+""}function _e(r,n){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var o=i.call(r,n);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function ge(r,n,i){typeof n=="symbol"&&(n=(n=n.description)?"["+n+"]":"");try{Object.defineProperty(r,"name",{configurable:!0,value:i?i+" "+n:n})}catch{}return r}function $e(r){if(Object(r)!==r)throw TypeError("right-hand side of 'in' should be an object, got "+(r!==null?typeof r:"null"));return r}let ye;class Be{async getModels(){try{return(await be.models.getModels()).data}catch(n){throw console.error("Failed to get models:",n),n}}async generateText(n){try{const i={textGenerationRequestDto:n};return(await be.models.generateText(i)).data}catch(i){throw console.error("Failed to generate text:",i),i}}}ke=Be;[ye,De]=Ge(ke,[Ne,Ne.Singleton],[],1).c;De();const ve=new ye,Le=({renderFormItem:r,form:n,handleFormChange:i})=>{const[o,d]=g.useState({shortIntroduction:!1,introduction:!1}),[E,b]=g.useState(null),[u,f]=g.useState(!0),[I,R]=g.useState(null);g.useEffect(()=>{(async()=>{try{f(!0);const x=(await ve.getModels()).models.find(G=>G.name==="DeepSeek-V3");!x||!x.id?(R("DeepSeek-V3模型未找到"),console.error("DeepSeek-V3 model not found in available models")):b(x)}catch(h){R("获取模型列表失败"),console.error("Error fetching models:",h)}finally{f(!1)}})()},[]);const m=async(p,h)=>{if(console.log(p,h),!E){console.error("无法生成文本：DeepSeek-V3模型未找到或尚未加载");return}d(x=>({...x,[p]:!0}));try{const x=n.getFieldValue("description");if(!x){console.warn(`Cannot generate text for ${h}: 'Character Description' is empty.`);return}const G=`根据以下角色描述，生成一个不超过50个汉字的简介，纯字符串，不要包含任何其他信息，不要使用markdown格式：

 角色描述: "${x}"`,L=`根据以下角色描述，生成一个不超过300个汉字的简介，需要包含角色性格、背景、经历、爱好、特长、目标、梦想等，纯字符串，不要包含任何其他信息，不要使用markdown格式：

 角色描述: "${x}"`,z={prompt:p==="shortIntroduction"?G:L,extraParams:{}},T=await ve.generateText(z),v=T.content;console.log(v),typeof v=="string"?(n.setFieldsValue({[p]:v}),i()):console.error(`Failed to generate text for ${h}: Invalid response format from AI.`,T)}catch(x){console.error(`Error generating text for ${h}:`,x)}finally{d(x=>({...x,[p]:!1}))}};return u?e.jsxDEV("div",{className:"text-center py-4",children:"正在加载可用模型..."},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:101,columnNumber:12},void 0):I?e.jsxDEV("div",{className:"text-center py-4 text-red-500",children:I},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:105,columnNumber:12},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"grid grid-cols-3 gap-4 mb-4 items-end",children:[e.jsxDEV("div",{className:"col-span-1",children:r("categoryIds","角色分类","categories")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:112,columnNumber:17},void 0),e.jsxDEV("div",{className:"col-span-1",children:r("tags","角色标签","tags")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:113,columnNumber:17},void 0),e.jsxDEV("div",{className:"col-span-1",children:r("name","角色名称")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:114,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:111,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("label",{className:"form-label",htmlFor:"shortIntroduction",children:"角色简介"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:120,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-start gap-2",children:[e.jsxDEV("div",{className:"flex-grow",children:r("shortIntroduction","","textarea")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:122,columnNumber:21},void 0),e.jsxDEV(he,{onClick:()=>m("shortIntroduction","角色简介"),disabled:o.shortIntroduction||!E,children:o.shortIntroduction?"生成中...":"AI 生成"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:125,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:121,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:119,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("label",{className:"form-label",htmlFor:"introduction",children:"角色详细介绍"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:137,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-start gap-2",children:[e.jsxDEV("div",{className:"flex-grow",children:r("introduction","","textarea")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:139,columnNumber:21},void 0),e.jsxDEV(he,{onClick:()=>m("introduction","角色详细介绍"),disabled:o.introduction||!E,children:o.introduction?"生成中...":"AI 生成"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:142,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:138,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:136,columnNumber:13},void 0),r("description","角色描述","textarea"),r("greetings","备选问候语","greetingsEditor")]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/KeyOptionsTab.tsx",lineNumber:109,columnNumber:5},void 0)},ze=({renderFormItem:r})=>e.jsxDEV(e.Fragment,{children:[r("personality","性格特点","textarea"),r("backgroundStory","背景故事","textarea",{rows:6}),r("behaviors","行为习惯","textarea")]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/PersonalityTab.tsx",lineNumber:7,columnNumber:5},void 0),Pe=({renderFormItem:r})=>e.jsxDEV(e.Fragment,{children:[r("languageStyle","语言风格","textarea"),r("expressionStyle","表达方式","textarea"),r("firstMessage","首次发言","textarea"),r("scenario","场景设定","textarea")]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/ConversationTab.tsx",lineNumber:7,columnNumber:5},void 0),Ue=({renderFormItem:r})=>e.jsxDEV(e.Fragment,{children:[r("systemPrompt","系统提示词","textarea",{rows:6}),r("postHistoryInstructions","历史记录后指令","textarea"),r("creatorNotes","创作者笔记","textarea")]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AdvancedTab.tsx",lineNumber:7,columnNumber:5},void 0),{Text:oe}=ae,qe=({character:r})=>r?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"p-4 bg-gray-50 rounded-md mb-4",children:e.jsxDEV(oe,{type:"secondary",children:"这里显示了AI模型的相关设置，包括使用的模型、参数等。 这些设置通常由系统维护，部分设置需要管理员权限才能修改。"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:17,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:16,columnNumber:13},void 0),r&&r.aiSettings&&Object.entries(r.aiSettings).map(([n,i])=>e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV(oe,{strong:!0,children:[n,":"," "]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:25,columnNumber:21},void 0),e.jsxDEV(oe,{children:typeof i=="object"?JSON.stringify(i):String(i)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:30,columnNumber:21},void 0)]},n,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:24,columnNumber:7},void 0))]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AiSettingsTab.tsx",lineNumber:15,columnNumber:5},void 0):null,{Text:C}=ae,Fe=({character:r})=>{var n;return r?e.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"创建时间: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:17,columnNumber:17},void 0),e.jsxDEV(C,{children:new Date(r.createdAt).toLocaleString()},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:18,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:16,columnNumber:13},void 0),e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"更新时间: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:21,columnNumber:17},void 0),e.jsxDEV(C,{children:new Date(r.updatedAt).toLocaleString()},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:22,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:20,columnNumber:13},void 0),e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"人气: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:25,columnNumber:17},void 0),e.jsxDEV(C,{children:r.popularity},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:26,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:24,columnNumber:13},void 0),e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"聊天数: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:29,columnNumber:17},void 0),e.jsxDEV(C,{children:r.useCount},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:30,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:28,columnNumber:13},void 0),e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"创建者: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:33,columnNumber:17},void 0),e.jsxDEV(C,{children:((n=r.creator)==null?void 0:n.nickname)||"未知"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:34,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:32,columnNumber:13},void 0),e.jsxDEV("div",{className:"p-4 border rounded-md",children:[e.jsxDEV(C,{strong:!0,children:"ID: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:37,columnNumber:17},void 0),e.jsxDEV(C,{children:r.id},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:38,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:36,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/StatsTab.tsx",lineNumber:15,columnNumber:5},void 0):null},Je=({visible:r,isApprove:n,auditing:i,auditReason:o,commonRejectReasons:d,onOk:E,onCancel:b,onReasonChange:u})=>e.jsxDEV(ne,{title:n?"通过审核":"拒绝理由",open:r,onOk:E,onCancel:b,confirmLoading:i,children:n?e.jsxDEV(Ee,{placeholder:"输入通过理由（可选）",defaultValue:"符合平台规范",onChange:f=>u(f.target.value)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:35,columnNumber:7},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(J,{style:{width:"100%",marginBottom:"10px"},placeholder:"选择拒绝理由",onChange:f=>u(f),allowClear:!0,children:d.map(f=>e.jsxDEV(J.Option,{value:f,children:f},f,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:50,columnNumber:11},void 0))},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:43,columnNumber:25},void 0),e.jsxDEV(de,{placeholder:"或输入自定义拒绝理由",value:o,onChange:f=>u(f.target.value),autoSize:{minRows:3,maxRows:5}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:55,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:42,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/components/AuditModal.tsx",lineNumber:26,columnNumber:5},void 0),{Title:We,Text:Ye}=ae,re=["name","description","shortIntroduction","introduction","avatarUrl","shouldBlurAvatar","personality","backgroundStory","behaviors","languageStyle","expressionStyle","firstMessage","scenario","messageExamples","systemPrompt","postHistoryInstructions","greetings","characterVersion","creatorNotes","sillyTavernRawData","categoryIds","tags","visibility"],He=[{label:"公开",value:"public"},{label:"私有",value:"private"}];function ir(){const n=je().id,i=Ve(),[o]=M.useForm(),[d,E]=g.useState(null),[b,u]=g.useState([]),[f,I]=g.useState(!0),[R,m]=g.useState(!1),[p,h]=g.useState(!1),[x,G]=g.useState({}),[L,z]=g.useState(!1),[T,v]=g.useState({visible:!1,isApprove:!1}),[W,U]=g.useState("");g.useEffect(()=>{if(!n){B.error("角色ID无效"),i("/card");return}async function a(){try{I(!0);const c=await xe(n);E(c);const k={};re.forEach(O=>{O in c&&(k[O]=c[O])}),c.categories&&Array.isArray(c.categories)&&(k.categoryIds=c.categories.map(O=>O.id)),o.setFieldsValue(k),G(k)}catch(c){console.error("获取角色详情失败:",c),B.error("获取角色详情失败，请稍后重试")}finally{I(!1)}}async function s(){try{const c=await Ce();c&&c.categories&&u(c.categories)}catch(c){console.error("获取类别数据失败:",c)}}a(),s()},[n,o,i]);const t=()=>{h(!0);const a=o.getFieldsValue();G(a),localStorage.setItem(`character_edit_${n}`,JSON.stringify(a))},j=async()=>{if(!n){B.error("角色ID无效");return}try{await o.validateFields();const a=o.getFieldsValue(),s={};re.forEach(k=>{k in a&&(s[k]=a[k])}),m(!0),await Ie(n,s),localStorage.removeItem(`character_edit_${n}`),B.success("角色更新成功"),h(!1);const c=await xe(n);E(c)}catch(a){console.error("更新角色失败:",a),B.error(`更新角色失败: ${a.message||"请稍后重试"}`)}finally{m(!1)}},V=()=>{ne.confirm({title:"确认取消",content:"您有未保存的更改，确定要取消吗？",onOk:()=>{if(d){const a={};re.forEach(s=>{s in d&&(a[s]=d[s])}),o.setFieldsValue(a)}localStorage.removeItem(`character_edit_${n}`),h(!1)}})},l=()=>{p?ne.confirm({title:"确认返回",content:"您有未保存的更改，确定要返回吗？",onOk:()=>i("/card")}):i("/card")},N=async a=>{if(!n){B.error("角色ID无效");return}if(p){ne.confirm({title:"未保存的更改",content:"角色有未保存的更改，请先保存更改后再进行审核。",okText:"保存并审核",cancelText:"取消",onOk:async()=>{try{await j(),v({visible:!0,isApprove:a})}catch(s){console.error("保存并审核失败:",s)}}});return}v({visible:!0,isApprove:a})},A=async(a,s)=>{try{z(!0);const c={status:a?"approved":"rejected",reason:s},k=await Re.auditCharacter(n,"",c);E(k),B.success(a?"角色已通过审核":"角色已被拒绝")}catch(c){console.error("审核角色失败:",c),B.error(`审核失败: ${c.message||"请稍后重试"}`)}finally{z(!1),v({visible:!1,isApprove:!1}),U("")}},K=["不符合平台规范","头像内容不适宜","描述内容不适宜","对话示例不适宜","背景故事内容不适宜","行为习惯内容不适宜","系统提示词不适宜"],w=(a,s,c="input",k)=>{const O=re.includes(a),{placeholder:_}=k||{};if(!O&&d)return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV("div",{className:"read-only-field",children:c==="textarea"?e.jsxDEV("pre",{className:"whitespace-pre-wrap",children:d[a]},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:304,columnNumber:13},this):e.jsxDEV(Ye,{children:d[a]},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:307,columnNumber:13},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:301,columnNumber:21},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:300,columnNumber:9},this);if(c==="greetingsEditor")return e.jsxDEV(M.Item,{label:s,name:a,valuePropName:"value",children:e.jsxDEV(Oe,{onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:318,columnNumber:21},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:317,columnNumber:9},this);switch(c){case"textarea":return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV(de,{placeholder:_,onChange:t,autoSize:{minRows:1,maxRows:15}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:328,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:327,columnNumber:11},this);case"switch":return e.jsxDEV(M.Item,{label:s,name:a,valuePropName:"checked",children:e.jsxDEV(we,{onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:338,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:337,columnNumber:11},this);case"select":return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV(J,{placeholder:_,options:He,onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:344,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:343,columnNumber:11},this);case"tags":return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV(J,{mode:"tags",placeholder:_||"请输入标签，按回车确认",onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:354,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:353,columnNumber:11},this);case"categories":return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV(J,{mode:"multiple",placeholder:_||"请选择分类",options:b.map(q=>({label:q.name,value:q.id})),onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:364,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:363,columnNumber:11},this);default:return e.jsxDEV(M.Item,{label:s,name:a,children:e.jsxDEV(Ee,{placeholder:_,onChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:375,columnNumber:25},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:374,columnNumber:11},this)}};return f?e.jsxDEV("div",{className:"flex items-center justify-center h-full",children:e.jsxDEV(Te,{size:"large",tip:"正在加载角色详情...",spinning:!0,children:e.jsxDEV("div",{className:"p-12"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:386,columnNumber:21},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:385,columnNumber:17},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:384,columnNumber:7},this):e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[e.jsxDEV(We,{level:3,children:(d==null?void 0:d.name)||"角色详情"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:396,columnNumber:17},this),e.jsxDEV("div",{children:[e.jsxDEV(P,{onClick:l,className:"mr-2",children:"返回"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:398,columnNumber:21},this),p&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV(P,{onClick:V,className:"mr-2",children:"取消"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:401,columnNumber:29},this),e.jsxDEV(P,{type:"primary",onClick:j,loading:R,children:"保存"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:402,columnNumber:29},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:400,columnNumber:11},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:397,columnNumber:17},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:395,columnNumber:13},this),e.jsxDEV(Je,{visible:T.visible,isApprove:T.isApprove,auditing:L,auditReason:W,commonRejectReasons:K,onOk:()=>A(T.isApprove,W||(T.isApprove?"符合平台规范":"不符合平台规范")),onCancel:()=>{v({visible:!1,isApprove:!1}),U("")},onReasonChange:U},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:415,columnNumber:13},this),d&&e.jsxDEV(M,{form:o,layout:"vertical",initialValues:x,children:e.jsxDEV(Ae,{defaultActiveKey:"review",items:[{key:"review",label:"审核",children:e.jsxDEV(Me,{character:d,renderFormItem:w,handleAuditCharacter:N,auditing:L,handleFormChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:442,columnNumber:13},this)},{key:"keyOptions",label:"关键选项",children:e.jsxDEV(Le,{renderFormItem:w,form:o,handleFormChange:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:455,columnNumber:13},this)},{key:"personality",label:"角色设定",children:e.jsxDEV(ze,{renderFormItem:w},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:462,columnNumber:13},this)},{key:"conversation",label:"对话设置",children:e.jsxDEV(Pe,{renderFormItem:w},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:469,columnNumber:13},this)},{key:"advanced",label:"高级设置",children:e.jsxDEV(Ue,{renderFormItem:w},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:476,columnNumber:13},this)},{key:"aiSettings",label:"AI模型设置",children:e.jsxDEV(qe,{character:d},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:483,columnNumber:13},this)},{key:"stats",label:"统计信息",children:e.jsxDEV(Fe,{character:d},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:490,columnNumber:13},this)}]},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:435,columnNumber:21},this)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:430,columnNumber:7},this)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/card/[id]/index.tsx",lineNumber:394,columnNumber:5},this)}export{ir as default};
