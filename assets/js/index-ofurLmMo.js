import{j as e}from"./index-CrhO62n3.js";import{r as f,u as ee,e as oe}from"./react-DR1zDSRy.js";import{A as P}from"./admin-preset-service-B2Vz9UtJ.js";import{G as ie,M as se,I as ue,L as de}from"./LogitBiasEditor-DzCpOEL5.js";import{PROMPT_ROLE_OPTIONS as L,INJECTION_POSITION_OPTIONS as ce}from"./types-Ccx87eRq.js";import{F as d,s,C as X,c as re,B as p,w as le,S as I,Q as pe,i as ne,M as Y,R,a as l,I as H,d as Z,T as W,b as fe,e as U,f as k,V as Ne,W as ge,r as O,X as xe,x as ae,Y as be,u as he,y as ke,t as we,Z as ve,v as Pe,h as De,j as me}from"./antd-BEURTGXr.js";import{A as q}from"./admin-service-CUuYx9Yq.js";import"./echarts-C5AzJBXJ.js";const{TextArea:Ee}=H,{Text:h,Paragraph:je}=ne,Ve={system:"SYSTEM",user:"USER",assistant:"ASSISTANT"},Me={SYSTEM:"system",USER:"user",ASSISTANT:"assistant"},ye=({presetId:t,onPromptsChange:j})=>{var y,F;const[N,g]=f.useState([]),[A,V]=f.useState(!1),[S,M]=f.useState(!1),[D,w]=f.useState(!1),[m,C]=f.useState(null),[E]=d.useForm(),i=f.useCallback(async()=>{V(!0);try{const n=((await P.getPresetPrompts(t)).prompts||[]).map(u=>({...u,role:Me[u.role]||"system"}));g(n),j==null||j(n)}catch(r){console.error("Failed to fetch prompts:",r),s.error("获取提示词列表失败")}finally{V(!1)}},[t,j]);f.useEffect(()=>{t&&i()},[t,i]);const c=()=>{C(null),E.resetFields(),E.setFieldsValue({role:"system",systemPrompt:!0,marker:!1,injectionPosition:0,injectionDepth:4,injectionOrder:100,forbidOverrides:!1,enabled:!0,extension:!1,sortOrder:N.length}),M(!0)},B=r=>{C(r),E.setFieldsValue(r),M(!0)},a=r=>{C(r),w(!0)},o=async r=>{try{const n={name:`${r.name} (副本)`,identifier:`${r.identifier}_copy_${Date.now()}`};await P.duplicatePrompt(t,r.id,n),s.success("提示词复制成功"),i()}catch(n){console.error("Failed to duplicate prompt:",n),s.error("复制提示词失败")}},x=async r=>{try{await P.deletePrompt(t,r),s.success("提示词删除成功"),i()}catch(n){console.error("Failed to delete prompt:",n),s.error("删除提示词失败")}},$=async(r,n)=>{try{n?await P.enablePrompt(t,r.id):await P.disablePrompt(t,r.id),s.success(`提示词已${n?"启用":"禁用"}`),i()}catch(u){console.error("Failed to toggle prompt:",u),s.error("操作失败")}},G=async()=>{try{const r=await E.validateFields(),n={...r,role:Ve[r.role]};m?(await P.updatePrompt(t,m.id,n),s.success("提示词更新成功")):(await P.createPrompt(t,n),s.success("提示词创建成功")),M(!1),i()}catch(r){console.error("Failed to save prompt:",r),s.error("保存提示词失败")}},K=async(r,n)=>{const u=N.findIndex(_=>_.id===r);if(u===-1)return;const T=n==="up"?u-1:u+1;if(T<0||T>=N.length)return;const v=[...N];[v[u],v[T]]=[v[T],v[u]],g(v);try{const _={promptIds:v.map(te=>te.id)};await P.reorderPrompts(t,_),s.success("排序已保存")}catch(_){console.error("Failed to reorder prompts:",_),s.error("保存排序失败"),i()}},J=r=>r.marker?"📌":r.systemPrompt&&!r.forbidOverrides?"📊":r.systemPrompt&&r.forbidOverrides?"⭐":!r.systemPrompt&&r.injectionPosition===1?"💉":"✱",Q=r=>r.marker?"标记":r.systemPrompt&&!r.forbidOverrides?"全局提示词":r.systemPrompt&&r.forbidOverrides?"重要提示词":!r.systemPrompt&&r.injectionPosition===1?"聊天注入":"预设提示词",b=[{title:"ID",dataIndex:"id",key:"id",width:80,render:(r,n)=>e.jsxDEV("a",{onClick:()=>B(n),style:{fontSize:"12px",fontFamily:"monospace"},children:r.slice(-6)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:256,columnNumber:5},void 0)},{title:"排序",key:"sort",width:80,render:(r,n,u)=>e.jsxDEV(I,{children:[e.jsxDEV(p,{type:"text",icon:e.jsxDEV(Ne,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:272,columnNumber:15},void 0),size:"small",disabled:u===0,onClick:()=>K(n.id,"up")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:270,columnNumber:11},void 0),e.jsxDEV(p,{type:"text",icon:e.jsxDEV(ge,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:279,columnNumber:15},void 0),size:"small",disabled:u===N.length-1,onClick:()=>K(n.id,"down")},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:277,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:269,columnNumber:5},void 0)},{title:"名称",dataIndex:"name",key:"name",width:200,render:(r,n)=>{var u,T;return e.jsxDEV(I,{children:[e.jsxDEV(O,{title:Q(n),children:e.jsxDEV("span",{style:{fontSize:"16px"},children:J(n)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:295,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:294,columnNumber:11},void 0),e.jsxDEV(p,{type:"link",onClick:()=>a(n),style:{padding:0},children:r},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:297,columnNumber:11},void 0),e.jsxDEV(k,{color:(u=L.find(v=>v.value===n.role))==null?void 0:u.color,children:(T=L.find(v=>v.value===n.role))==null?void 0:T.label},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:300,columnNumber:11},void 0),n.injectionPosition===1&&e.jsxDEV(k,{color:"purple",children:["@",n.injectionDepth]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:304,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:293,columnNumber:5},void 0)}},{title:"标识符",dataIndex:"identifier",key:"identifier",width:150,render:r=>e.jsxDEV(h,{code:!0,children:r},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:317,columnNumber:31},void 0)},{title:"状态",dataIndex:"enabled",key:"enabled",width:80,render:(r,n)=>e.jsxDEV(U,{checked:r,onChange:u=>$(n,u),size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:325,columnNumber:5},void 0)},{title:"令牌",key:"tokens",width:80,render:()=>e.jsxDEV(h,{type:"secondary",children:"-"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:336,columnNumber:19},void 0)},{title:"操作",key:"actions",width:150,render:(r,n)=>e.jsxDEV(I,{size:"small",children:[e.jsxDEV(O,{title:"查看",children:e.jsxDEV(p,{type:"text",icon:e.jsxDEV(xe,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:347,columnNumber:17},void 0),onClick:()=>a(n),size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:345,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:344,columnNumber:11},void 0),e.jsxDEV(O,{title:"编辑",children:e.jsxDEV(p,{type:"text",icon:e.jsxDEV(ae,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:355,columnNumber:17},void 0),onClick:()=>B(n),size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:353,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:352,columnNumber:11},void 0),e.jsxDEV(O,{title:"复制",children:e.jsxDEV(p,{type:"text",icon:e.jsxDEV(be,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:363,columnNumber:17},void 0),onClick:()=>o(n),size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:361,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:360,columnNumber:11},void 0),e.jsxDEV(O,{title:"删除",children:e.jsxDEV(he,{title:"确定要删除这个提示词吗？",onConfirm:()=>x(n.id),okText:"确定",cancelText:"取消",children:e.jsxDEV(p,{type:"text",icon:e.jsxDEV(ke,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:377,columnNumber:19},void 0),danger:!0,size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:375,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:369,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:368,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:343,columnNumber:5},void 0)}];return e.jsxDEV("div",{children:[e.jsxDEV(X,{title:e.jsxDEV(I,{children:[e.jsxDEV(pe,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:393,columnNumber:13},void 0),e.jsxDEV("span",{children:"提示词管理"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:394,columnNumber:13},void 0),e.jsxDEV(h,{type:"secondary",children:["(",N.length," ","个提示词)"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:395,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:392,columnNumber:9},void 0),extra:e.jsxDEV(p,{type:"primary",icon:e.jsxDEV(le,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:404,columnNumber:38},void 0),onClick:c,children:"添加提示词"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:404,columnNumber:9},void 0),children:e.jsxDEV(re,{rowKey:"id",columns:b,dataSource:N,loading:A,pagination:!1,size:"small"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:409,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:390,columnNumber:7},void 0),e.jsxDEV(Y,{title:m?"编辑提示词":"创建提示词",open:S,onCancel:()=>M(!1),onOk:G,width:800,destroyOnClose:!0,children:e.jsxDEV(d,{form:E,layout:"vertical",children:[e.jsxDEV(R,{gutter:16,children:[e.jsxDEV(l,{span:12,children:e.jsxDEV(d.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入提示词名称"}],children:e.jsxDEV(H,{placeholder:"请输入提示词名称"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:436,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:431,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:430,columnNumber:13},void 0),e.jsxDEV(l,{span:12,children:e.jsxDEV(d.Item,{name:"identifier",label:"标识符",rules:[{required:!0,message:"请输入标识符"}],children:e.jsxDEV(H,{placeholder:"请输入唯一标识符"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:445,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:440,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:439,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:429,columnNumber:11},void 0),e.jsxDEV(d.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入提示词内容"}],children:e.jsxDEV(Ee,{rows:8,placeholder:"请输入提示词内容",showCount:!0},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:455,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:450,columnNumber:11},void 0),e.jsxDEV(R,{gutter:16,children:[e.jsxDEV(l,{span:8,children:e.jsxDEV(d.Item,{name:"role",label:"角色",children:e.jsxDEV(Z,{options:L},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:465,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:464,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:463,columnNumber:13},void 0),e.jsxDEV(l,{span:8,children:e.jsxDEV(d.Item,{name:"injectionPosition",label:"注入位置",children:e.jsxDEV(Z,{options:ce},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:470,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:469,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:468,columnNumber:13},void 0),e.jsxDEV(l,{span:8,children:e.jsxDEV(d.Item,{name:"injectionDepth",label:"注入深度",children:e.jsxDEV(W,{min:0,max:100,style:{width:"100%"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:475,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:474,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:473,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:462,columnNumber:11},void 0),e.jsxDEV(R,{gutter:16,children:[e.jsxDEV(l,{span:8,children:e.jsxDEV(d.Item,{name:"injectionOrder",label:"注入顺序",children:e.jsxDEV(W,{min:0,max:1e3,style:{width:"100%"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:483,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:482,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:481,columnNumber:13},void 0),e.jsxDEV(l,{span:8,children:e.jsxDEV(d.Item,{name:"sortOrder",label:"排序",children:e.jsxDEV(W,{min:0,style:{width:"100%"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:488,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:487,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:486,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:480,columnNumber:11},void 0),e.jsxDEV(fe,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:493,columnNumber:11},void 0),e.jsxDEV(R,{gutter:16,children:[e.jsxDEV(l,{span:6,children:e.jsxDEV(d.Item,{name:"systemPrompt",valuePropName:"checked",children:e.jsxDEV(U,{checkedChildren:"系统提示词",unCheckedChildren:"普通提示词"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:498,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:497,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:496,columnNumber:13},void 0),e.jsxDEV(l,{span:6,children:e.jsxDEV(d.Item,{name:"marker",valuePropName:"checked",children:e.jsxDEV(U,{checkedChildren:"标记",unCheckedChildren:"非标记"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:503,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:502,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:501,columnNumber:13},void 0),e.jsxDEV(l,{span:6,children:e.jsxDEV(d.Item,{name:"forbidOverrides",valuePropName:"checked",children:e.jsxDEV(U,{checkedChildren:"禁止覆盖",unCheckedChildren:"允许覆盖"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:508,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:507,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:506,columnNumber:13},void 0),e.jsxDEV(l,{span:6,children:e.jsxDEV(d.Item,{name:"enabled",valuePropName:"checked",children:e.jsxDEV(U,{checkedChildren:"启用",unCheckedChildren:"禁用"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:513,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:512,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:511,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:495,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:428,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:420,columnNumber:7},void 0),e.jsxDEV(Y,{title:`查看提示词: ${m==null?void 0:m.name}`,open:D,onCancel:()=>w(!1),footer:[e.jsxDEV(p,{onClick:()=>w(!1),children:"关闭"},"close",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:526,columnNumber:9},void 0),e.jsxDEV(p,{type:"primary",onClick:()=>{w(!1),B(m)},children:"编辑"},"edit",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:529,columnNumber:9},void 0)],width:800,children:m&&e.jsxDEV("div",{children:[e.jsxDEV(R,{gutter:16,style:{marginBottom:16},children:[e.jsxDEV(l,{span:12,children:[e.jsxDEV(h,{strong:!0,children:"标识符: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:546,columnNumber:17},void 0),e.jsxDEV(h,{code:!0,children:m.identifier},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:547,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:545,columnNumber:15},void 0),e.jsxDEV(l,{span:12,children:[e.jsxDEV(h,{strong:!0,children:"角色: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:550,columnNumber:17},void 0),e.jsxDEV(k,{color:(y=L.find(r=>r.value===m.role))==null?void 0:y.color,children:(F=L.find(r=>r.value===m.role))==null?void 0:F.label},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:551,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:549,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:544,columnNumber:13},void 0),e.jsxDEV(R,{gutter:16,style:{marginBottom:16},children:[e.jsxDEV(l,{span:8,children:[e.jsxDEV(h,{strong:!0,children:"注入位置: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:559,columnNumber:17},void 0),e.jsxDEV(h,{children:m.injectionPosition===0?"相对位置":"绝对位置"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:560,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:558,columnNumber:15},void 0),e.jsxDEV(l,{span:8,children:[e.jsxDEV(h,{strong:!0,children:"注入深度: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:563,columnNumber:17},void 0),e.jsxDEV(h,{children:m.injectionDepth},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:564,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:562,columnNumber:15},void 0),e.jsxDEV(l,{span:8,children:[e.jsxDEV(h,{strong:!0,children:"注入顺序: "},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:567,columnNumber:17},void 0),e.jsxDEV(h,{children:m.injectionOrder},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:568,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:566,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:557,columnNumber:13},void 0),e.jsxDEV("div",{style:{marginBottom:16},children:[e.jsxDEV(h,{strong:!0,children:"内容:"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:573,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginTop:8,padding:12,border:"1px solid #d9d9d9",borderRadius:6,backgroundColor:"#fafafa",maxHeight:300,overflow:"auto"},children:e.jsxDEV(je,{style:{margin:0,whiteSpace:"pre-wrap"},children:m.content},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:584,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:574,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:572,columnNumber:13},void 0),e.jsxDEV(I,{children:[e.jsxDEV(k,{color:m.enabled?"green":"red",children:m.enabled?"已启用":"已禁用"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:591,columnNumber:15},void 0),m.systemPrompt&&e.jsxDEV(k,{color:"blue",children:"系统提示词"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:594,columnNumber:46},void 0),m.marker&&e.jsxDEV(k,{color:"orange",children:"标记"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:595,columnNumber:40},void 0),m.forbidOverrides&&e.jsxDEV(k,{color:"purple",children:"禁止覆盖"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:596,columnNumber:49},void 0),m.extension&&e.jsxDEV(k,{color:"cyan",children:"扩展"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:597,columnNumber:43},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:590,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:543,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:521,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/form/PromptManager.tsx",lineNumber:389,columnNumber:5},void 0)},Ie=({presetId:t,presetName:j})=>{const N=ee(),[g,A]=f.useState([]),[V,S]=f.useState(!1),[M,D]=f.useState(null),w=async()=>{S(!0);try{let a=[],o=1;const x=100;for(;;){const b=await q.getAllParameters(o,x);if(a=[...a,...b],b.length<x)break;o++}const $=await q.getAllModels(),G=new Map($.map(b=>[b.id,b])),K=await q.getAllProviders(),J=new Map(K.map(b=>[b.id,b])),Q=a.map(b=>{const y=G.get(b.modelId),F=y?J.get(y.providerId):null;return{...b,modelName:(y==null?void 0:y.name)||"Unknown Model",providerName:(F==null?void 0:F.name)||"Unknown Provider"}});A(Q)}catch(a){console.error("Failed to fetch model parameters:",a),s.error("获取模型参数列表失败")}finally{S(!1)}};f.useEffect(()=>{w()},[]);const m=async(a,o)=>{Y.confirm({title:"确认绑定",content:`确定要将预设 "${j}" 绑定到参数集 "${o}" 吗？`,onOk:async()=>{D(a);try{await q.setModelParameterPreset(a,t),s.success("绑定成功"),await w()}catch(x){console.error("Failed to bind preset:",x),s.error("绑定失败")}finally{D(null)}}})},C=async(a,o)=>{Y.confirm({title:"确认解绑",content:`确定要解除参数集 "${o}" 与预设的绑定吗？`,onOk:async()=>{D(a);try{await q.setModelParameterPreset(a,null),s.success("解绑成功"),await w()}catch(x){console.error("Failed to unbind preset:",x),s.error("解绑失败")}finally{D(null)}}})},E=a=>{N(`/modelparameter/${a}/edit`)},i=[{title:"参数ID",dataIndex:"id",key:"id",width:150,render:a=>e.jsxDEV(p,{type:"link",size:"small",icon:e.jsxDEV(ae,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:134,columnNumber:13},void 0),onClick:()=>E(a),style:{padding:0,height:"auto"},children:e.jsxDEV(O,{title:"点击编辑参数",children:[a.slice(0,8),"..."]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:138,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:131,columnNumber:5},void 0)},{title:"参数集名称",dataIndex:"parameterSetName",key:"parameterSetName",width:200},{title:"模型",dataIndex:"modelName",key:"modelName",width:150},{title:"供应商",dataIndex:"providerName",key:"providerName",width:120},{title:"绑定状态",key:"bindingStatus",width:120,render:(a,o)=>{const x=o.presetId===t;return e.jsxDEV(k,{color:x?"green":"default",children:x?"已绑定":"未绑定"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:170,columnNumber:9},void 0)}},{title:"当前预设",dataIndex:"presetId",key:"presetId",width:150,render:a=>a?e.jsxDEV(O,{title:a,children:e.jsxDEV(k,{color:"blue",children:[a.slice(0,8),"..."]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:187,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:186,columnNumber:9},void 0):e.jsxDEV(k,{color:"default",children:"无"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:183,columnNumber:16},void 0)},{title:"操作",key:"actions",width:120,render:(a,o)=>{const x=o.presetId===t,$=M===o.id;return e.jsxDEV(I,{children:x?e.jsxDEV(p,{type:"link",danger:!0,size:"small",icon:e.jsxDEV(ve,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:211,columnNumber:19},void 0),loading:$,onClick:()=>C(o.id,o.parameterSetName),children:"解绑"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:207,columnNumber:11},void 0):e.jsxDEV(p,{type:"link",size:"small",icon:e.jsxDEV(Pe,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:222,columnNumber:19},void 0),loading:$,onClick:()=>m(o.id,o.parameterSetName),disabled:!!o.presetId,children:"绑定"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:219,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:204,columnNumber:9},void 0)}}],c=g.filter(a=>a.presetId===t).length,B=g.length;return e.jsxDEV(X,{title:e.jsxDEV(I,{children:[e.jsxDEV("span",{children:"模型参数绑定管理"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:243,columnNumber:11},void 0),e.jsxDEV(k,{color:"blue",children:[c,"/",B," ","已绑定"]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:244,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:242,columnNumber:7},void 0),extra:e.jsxDEV(p,{icon:e.jsxDEV(we,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:255,columnNumber:15},void 0),onClick:w,loading:V,children:"刷新"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:254,columnNumber:7},void 0),children:e.jsxDEV(re,{columns:i,dataSource:g,rowKey:"id",loading:V,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,o)=>`第 ${o[0]}-${o[1]} 条，共 ${a} 条`},scroll:{x:800}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:263,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/components/ModelParameterBinding.tsx",lineNumber:240,columnNumber:5},void 0)},{Title:Se}=ne,{TabPane:z}=me,Ae=()=>{const{id:t}=oe(),j=ee(),[N]=d.useForm(),[g,A]=f.useState(null),[V,S]=f.useState(!0),[M,D]=f.useState(!1),w=d.useWatch("type",N),m=async()=>{if(t){S(!0);try{const i=await P.findPresetById(t),c={...i,description:i.description||void 0,tags:i.tags||[]};A(c);const B={...c,instructModeData:c.instructModeData?{...c.instructModeData}:void 0,logitBias:c.logitBias?[...c.logitBias]:void 0,tags:c.tags?[...c.tags]:[],stop:c.stop?[...c.stop]:[]};N.setFieldsValue(B)}catch(i){console.error("Failed to fetch preset details:",i),s.error("获取预设详情失败")}finally{S(!1)}}};f.useEffect(()=>{m()},[t]);const C=async()=>{if(!(!t||!g))try{D(!0);const i=await N.validateFields(),c={...i,type:i.type};await P.updatePreset(t,c),s.success("预设更新成功"),await m()}catch(i){console.error("Failed to save preset:",i),s.error("保存预设失败，请检查表单或联系管理员")}finally{D(!1)}},E=()=>{j("/preset")};return e.jsxDEV("div",{style:{padding:"24px"},children:e.jsxDEV(I,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsxDEV("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"},children:[e.jsxDEV(p,{icon:e.jsxDEV(De,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:100,columnNumber:19},void 0),onClick:E,style:{marginRight:"16px"},children:"返回列表"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:99,columnNumber:11},void 0),e.jsxDEV(Se,{level:3,style:{marginBottom:0},children:g?`编辑预设: ${g.name}`:"编辑预设"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:106,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:98,columnNumber:9},void 0),e.jsxDEV(X,{loading:V,children:e.jsxDEV(d,{form:N,layout:"vertical",name:"preset_edit_form",children:e.jsxDEV(me,{defaultActiveKey:"1",tabBarExtraContent:e.jsxDEV(p,{type:"primary",loading:M,onClick:C,disabled:V,children:"保存更改"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:117,columnNumber:15},void 0),children:[e.jsxDEV(z,{tab:"通用设置",children:e.jsxDEV(ie,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:128,columnNumber:17},void 0)},"1",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:127,columnNumber:15},void 0),e.jsxDEV(z,{tab:"模型参数",children:e.jsxDEV(se,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:131,columnNumber:17},void 0)},"2",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:130,columnNumber:15},void 0),w==="instruct"&&e.jsxDEV(z,{tab:"指令设置",children:e.jsxDEV(ue,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:135,columnNumber:19},void 0)},"3",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:134,columnNumber:15},void 0),e.jsxDEV(z,{tab:"Logit Bias",children:e.jsxDEV(de,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:139,columnNumber:17},void 0)},"4",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:138,columnNumber:15},void 0),e.jsxDEV(z,{tab:"提示词管理",children:e.jsxDEV(ye,{presetId:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:142,columnNumber:17},void 0)},"5",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:141,columnNumber:15},void 0),e.jsxDEV(z,{tab:"模型参数绑定",children:e.jsxDEV(Ie,{presetId:t,presetName:(g==null?void 0:g.name)||"未知预设"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:145,columnNumber:17},void 0)},"6",!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:144,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:114,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:113,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:112,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:96,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/preset/[id]/index.tsx",lineNumber:95,columnNumber:5},void 0)};export{Ae as default};
