import{j as e}from"./index-Bq-st_Rd.js";import{r as o,n as de,u as xe}from"./react-DNsX-D9n.js";import{g as me,a as he,b as ue,c as je,d as pe,e as fe,f as ge}from"./admin-D-4RAlLd.js";import{F as c,E as G,c as y,a as V,B as u,N as H,o as b,n as ye,O as be,v as Ie,g as K,S as E,H as M,I as Y,s as x,T as N,R as U,b as h,Q as g,V as Se,W as Q,X as ve,p as L,e as X,y as ee,Y as we,Z,G as te}from"./antd-Bzi-nNZC.js";import"./echarts-C9Czxobr.js";import"./admin-service-EATBz3FM.js";function J(){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let p=0;p<6;p++)s+=r.charAt(Math.floor(Math.random()*r.length));return s}const ke=({userId:r})=>{const[s,p]=o.useState(null),[i,I]=o.useState(!1),[C,d]=o.useState(!1),[v,m]=o.useState(!1),[D,w]=o.useState(!1),[F]=c.useForm(),[P]=c.useForm(),[k,W]=o.useState([]),[z,R]=o.useState(!1),[a,j]=o.useState(1),[S]=o.useState(10),[$,se]=o.useState(0),ae=[{title:"资产类型ID",dataIndex:"assetTypeId",key:"assetTypeId",width:"25%",render:t=>e.jsx(N,{color:"blue",children:t.length>6?`${t.substring(0,6)}...`:t})},{title:"资产代码",dataIndex:"code",key:"code",width:"15%",render:t=>e.jsx(N,{color:"green",children:t})},{title:"可用余额",dataIndex:"balance",key:"balance",render:t=>t.toLocaleString()},{title:"冻结余额",dataIndex:"frozenBalance",key:"frozenBalance",render:t=>t.toLocaleString()},{title:"总余额",dataIndex:"totalBalance",key:"totalBalance",render:t=>e.jsx("span",{className:"font-semibold text-blue-600",children:t.toLocaleString()})}],ne=[{title:"交易ID",dataIndex:"id",key:"id",width:"15%",ellipsis:!0},{title:"唯一标识",dataIndex:"uniqueId",key:"uniqueId",width:"10%",ellipsis:!0},{title:"资产类型",dataIndex:"assetTypeId",key:"assetTypeId",width:"12%",render:t=>e.jsx(N,{color:"blue",children:t.length>6?`${t.substring(0,6)}...`:t})},{title:"交易金额",dataIndex:"amount",key:"amount",width:"10%",render:t=>{const n=Number.parseFloat(t);return e.jsx("span",{className:n>=0?"text-green-600":"text-red-600",children:n.toLocaleString()})}},{title:"交易类型",dataIndex:"type",key:"type",width:"10%",render:t=>{let n="default",l=t;switch(t){case"DEPOSIT":n="green",l="充值";break;case"WITHDRAW":n="red",l="提现";break;case"TRANSFER":n="blue",l="转账";break;case"PAYMENT":n="orange",l="支付";break;case"REFUND":n="cyan",l="退款";break;case"COMMISSION":n="purple",l="佣金";break}return e.jsx(N,{color:n,children:l})}},{title:"状态",dataIndex:"status",key:"status",width:"10%",render:t=>{let n="default",l=t;switch(t){case"COMPLETED":n="green",l="完成";break;case"PENDING":n="orange",l="待处理";break;case"FAILED":n="red",l="失败";break;case"PROCESSING":n="blue",l="处理中";break}return e.jsx(N,{color:n,children:l})}},{title:"原因",dataIndex:"reason",key:"reason",width:"15%",ellipsis:!0},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:"15%",render:t=>new Date(t).toLocaleString()}],A=async()=>{if(r){I(!0);try{const t=await me(r);p(t),console.log(`成功获取用户 ${r} 的钱包信息:`,t),t.assets&&t.assets.length>0&&console.log("资产数据示例:",t.assets[0])}catch(t){console.error(`获取用户 ${r} 钱包失败:`,t),x.error("获取钱包信息失败，请稍后重试")}finally{I(!1)}}},B=async(t=1,n=10)=>{if(r){R(!0);try{const f=await he(r,t,n),T=f&&f.items?f.items:[];W(T);const O=f&&f.total?f.total:0;se(O),console.log(`成功获取用户 ${r} 的交易记录:`,T)}catch(l){console.error(`获取用户 ${r} 交易记录失败:`,l),x.error("获取交易记录失败，请稍后重试")}finally{R(!1)}}},re=(t,n)=>{j(t),B(t,n||S)},le=t=>{F.resetFields(),d(!0)},ie=t=>{P.resetFields(),m(!0)},oe=async t=>{w(!0);try{const n=J();await ue(r,t.assetTypeId,t.amount,n,t.reason,{operator:"admin",timestamp:new Date().toISOString()}),x.success("充值操作成功"),d(!1),A()}catch(n){console.error("充值操作失败:",n),x.error("充值操作失败，请稍后重试")}finally{w(!1)}},ce=async t=>{w(!0);try{const n=J();await je(r,t.assetTypeId,t.amount,n,t.reason,{operator:"admin",timestamp:new Date().toISOString()}),x.success("提现操作成功"),m(!1),A()}catch(n){console.error("提现操作失败:",n),x.error("提现操作失败，请稍后重试")}finally{w(!1)}};return o.useEffect(()=>{A(),B(a,S)},[r]),e.jsxs("div",{className:"mt-4",children:[i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(G,{tip:"正在加载钱包数据..."})}):s?e.jsxs("div",{children:[e.jsxs(y,{title:"钱包信息",className:"mb-6",extra:e.jsxs(V,{children:[e.jsxs("span",{children:["创建时间:",new Date(s.createdAt).toLocaleString()]}),e.jsx(u,{icon:e.jsx(H,{}),onClick:A,size:"small",children:"刷新"})]}),children:[e.jsxs("p",{children:[e.jsx("strong",{children:"钱包ID:"})," "," "," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"更新时间:"})," "," "," ",new Date(s.updatedAt).toLocaleString()]})]}),e.jsx(y,{title:"资产明细",extra:e.jsxs(V,{children:[e.jsx(u,{type:"primary",icon:e.jsx(ye,{}),onClick:()=>le(),children:"添加资金"}),e.jsx(u,{danger:!0,icon:e.jsx(be,{}),onClick:()=>ie(),children:"提取资金"})]}),children:e.jsx(b,{dataSource:s.assets,columns:ae,rowKey:"assetTypeId",pagination:!1,summary:t=>{if(t.length===0)return null;let n=0;return t.forEach(({totalBalance:l})=>{n+=l}),e.jsxs(b.Summary.Row,{children:[e.jsx(b.Summary.Cell,{index:0,colSpan:4,children:e.jsx("strong",{children:"总资产价值"})}),e.jsx(b.Summary.Cell,{index:1,children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:n.toLocaleString()})})]})}})}),e.jsxs(y,{title:"交易历史记录",className:"mt-6",extra:e.jsx(u,{icon:e.jsx(H,{}),onClick:()=>B(a,S),size:"small",children:"刷新"}),children:[e.jsx(b,{dataSource:k||[],columns:ne,rowKey:"id",loading:z,pagination:!1,scroll:{x:1e3},locale:{emptyText:"暂无交易记录"}}),k.length>0&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(Ie,{current:a,pageSize:S,total:$,onChange:re,showSizeChanger:!1,showTotal:t=>`共 ${t} 条记录`})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{children:"暂无钱包数据，请点击加载按钮"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",onClick:A,type:"button",children:"加载钱包数据"})]}),e.jsx(K,{title:"充值操作",open:C,onCancel:()=>d(!1),footer:null,maskClosable:!1,children:e.jsxs(c,{form:F,layout:"vertical",onFinish:oe,children:[e.jsx(c.Item,{name:"assetTypeId",label:"资产类型ID",rules:[{required:!0,message:"请选择资产类型"}],children:e.jsx(E,{placeholder:"请选择资产类型",children:s==null?void 0:s.assets.map(t=>e.jsxs(E.Option,{value:t.assetTypeId,children:[t.code," ","-",t.assetTypeId]},t.assetTypeId))})}),e.jsx(c.Item,{name:"amount",label:"充值金额",rules:[{required:!0,message:"请输入充值金额"},{type:"number",min:.01,message:"金额必须大于0"}],children:e.jsx(M,{style:{width:"100%"},placeholder:"请输入充值金额",precision:2,min:.01})}),e.jsx(c.Item,{name:"reason",label:"充值原因",children:e.jsx(Y.TextArea,{placeholder:"请输入充值原因（可选）",autoSize:{minRows:2,maxRows:4}})}),e.jsx(c.Item,{children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(u,{onClick:()=>d(!1),style:{marginRight:8},children:"取消"}),e.jsx(u,{type:"primary",htmlType:"submit",loading:D,children:"确认充值"})]})})]})}),e.jsx(K,{title:"提现操作",open:v,onCancel:()=>m(!1),footer:null,maskClosable:!1,children:e.jsxs(c,{form:P,layout:"vertical",onFinish:ce,children:[e.jsx(c.Item,{name:"assetTypeId",label:"资产类型ID",rules:[{required:!0,message:"请选择资产类型"}],children:e.jsx(E,{placeholder:"请选择资产类型",children:s==null?void 0:s.assets.map(t=>e.jsxs(E.Option,{value:t.assetTypeId,children:[t.code," ","-",t.assetTypeId," ","(可用余额:",t.balance,")"]},t.assetTypeId))})}),e.jsx(c.Item,{name:"amount",label:"提现金额",rules:[{required:!0,message:"请输入提现金额"},{type:"number",min:.01,message:"金额必须大于0"},({getFieldValue:t})=>({validator(n,l){const f=t("assetTypeId");if(!f||!l)return Promise.resolve();const T=s==null?void 0:s.assets.find(O=>O.assetTypeId===f);return T&&l>T.balance?Promise.reject(new Error(`提现金额不能超过可用余额(${T.balance})`)):Promise.resolve()}})],children:e.jsx(M,{style:{width:"100%"},placeholder:"请输入提现金额",precision:2,min:.01})}),e.jsx(c.Item,{name:"reason",label:"提现原因",children:e.jsx(Y.TextArea,{placeholder:"请输入提现原因（可选）",autoSize:{minRows:2,maxRows:4}})}),e.jsx(c.Item,{children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(u,{onClick:()=>m(!1),style:{marginRight:8},children:"取消"}),e.jsx(u,{danger:!0,htmlType:"submit",loading:D,children:"确认提现"})]})})]})})]})},{Text:Te}=ee,Ne=({userId:r})=>{var R;const[s,p]=o.useState(null),[i,I]=o.useState(!1),[C,d]=o.useState(!1),[v]=c.useForm(),[m,D]=o.useState(!1),w=[{title:"用户ID",dataIndex:"id",key:"id",width:"40%",ellipsis:!0},{title:"用户名",dataIndex:"username",key:"username"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleString()}],F=[{title:"用户ID",dataIndex:"id",key:"id",width:"25%",ellipsis:!0},{title:"用户名",dataIndex:"username",key:"username"},{title:"级别",dataIndex:"level",key:"level",render:a=>e.jsx(Z,{count:a,style:{backgroundColor:a===1?"#52c41a":"#1890ff"}})},{title:"贡献佣金",dataIndex:"commissionAmount",key:"commissionAmount",render:a=>e.jsx("span",{className:"text-green-600 font-medium",children:a})},{title:"消费金额",dataIndex:"spentAmount",key:"spentAmount"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleString()}],P=[{title:"邀请码",dataIndex:"code",key:"code",render:a=>e.jsx(N,{color:"purple",children:a})},{title:"总邀请人数",dataIndex:"totalInvitees",key:"totalInvitees"},{title:"今日邀请",dataIndex:"todayInvitees",key:"todayInvitees",render:a=>a>0?e.jsx(Z,{count:a,style:{backgroundColor:"#52c41a"}}):0},{title:"总收益",dataIndex:"totalProfit",key:"totalProfit",render:a=>e.jsx("span",{className:"text-green-600 font-medium",children:a})},{title:"今日收益",dataIndex:"todayProfit",key:"todayProfit",render:a=>e.jsx("span",{className:"text-green-600 font-medium",children:a})},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleString()}],k=async()=>{if(r){I(!0);try{const a=await pe(r);p(a),console.log(`成功获取用户 ${r} 的邀请信息:`,a)}catch(a){console.error(`获取用户 ${r} 邀请数据失败:`,a),x.error("获取邀请数据失败，请稍后重试")}finally{I(!1)}}},W=()=>{if(!(s!=null&&s.commissionRates)){x.error("无法获取当前佣金设置");return}const a=s.commissionRates.map(j=>({level:j.level||0,rate:j.rate||0}));v.setFieldsValue({rates:a}),d(!0)},z=async a=>{if(r){D(!0);try{await fe({userId:r,rates:a.rates}),x.success("佣金比例设置成功"),d(!1),k()}catch(j){console.error("设置佣金比例失败:",j),x.error("设置佣金比例失败，请稍后重试")}finally{D(!1)}}};return o.useEffect(()=>{k()},[r]),e.jsx("div",{className:"mt-4",children:i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(G,{tip:"正在加载邀请数据..."})}):s?e.jsxs("div",{children:[e.jsx(y,{title:"邀请数据摘要",className:"mb-6",children:e.jsxs(U,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(g,{title:"累计佣金",value:s.totalAmount,prefix:e.jsx(Se,{}),valueStyle:{color:"#3f8600"}})}),e.jsx(h,{span:8,children:e.jsx(g,{title:"直接下线数",value:((R=s.referralStatistics)==null?void 0:R.level1)||0,prefix:e.jsx(Q,{})})}),e.jsx(h,{span:8,children:e.jsx(g,{title:"邀请码数量",value:s.invitationCodesStatistics.length,prefix:e.jsx(ve,{})})})]})}),s.referralStatistics&&e.jsx(y,{title:"下线统计数据",className:"mb-6",children:e.jsxs(U,{gutter:16,children:[e.jsx(h,{span:4,children:e.jsx(g,{title:"一级下线",value:s.referralStatistics.level1,prefix:e.jsx(L,{})})}),e.jsx(h,{span:4,children:e.jsx(g,{title:"二级下线",value:s.referralStatistics.level2,prefix:e.jsx(L,{})})}),e.jsx(h,{span:4,children:e.jsx(g,{title:"三级下线",value:s.referralStatistics.level3,prefix:e.jsx(L,{})})}),e.jsx(h,{span:4,children:e.jsx(g,{title:"四级下线",value:s.referralStatistics.level4,prefix:e.jsx(L,{})})}),e.jsx(h,{span:4,children:e.jsx(g,{title:"五级下线",value:s.referralStatistics.level5,prefix:e.jsx(L,{})})}),e.jsx(h,{span:4,children:e.jsx(g,{title:"下线总数",value:s.referralStatistics.total,prefix:e.jsx(Q,{}),valueStyle:{color:"#1890ff",fontWeight:"bold"}})})]})}),e.jsx(y,{title:"邀请码统计",className:"mb-6",children:e.jsx(b,{dataSource:s.invitationCodesStatistics,columns:P,rowKey:"code",pagination:s.invitationCodesStatistics.length>10?{pageSize:10}:!1})}),s.commissionRates&&s.commissionRates.length>0&&e.jsx(y,{title:"佣金配置",className:"mb-6",extra:e.jsx(u,{type:"primary",icon:e.jsx(we,{}),onClick:W,children:"设置佣金比例"}),children:e.jsx(X,{bordered:!0,column:1,children:s.commissionRates.map((a,j)=>e.jsx(X.Item,{label:`等级 ${a.level}`,children:e.jsxs(Te,{strong:!0,className:"text-red-600",children:[a.rate,"%"]})},j))})}),s.upline&&s.upline.length>0&&e.jsx(y,{title:"上级用户",className:"mb-6",children:e.jsx(b,{dataSource:s.upline,columns:w,rowKey:"id",pagination:!1})}),s.downline&&s.downline.length>0&&e.jsx(y,{title:"下级用户",className:"mb-6",children:e.jsx(b,{dataSource:s.downline,columns:F,rowKey:"id",pagination:s.downline.length>10?{pageSize:10}:!1})}),e.jsx(K,{title:"设置用户佣金比例",open:C,onCancel:()=>d(!1),footer:null,maskClosable:!1,width:600,children:e.jsxs(c,{form:v,layout:"vertical",onFinish:z,children:[e.jsx(c.List,{name:"rates",children:a=>e.jsx(e.Fragment,{children:a.map(({key:j,name:S,...$})=>e.jsxs(U,{gutter:16,align:"middle",children:[e.jsx(h,{span:8,children:e.jsx(c.Item,{...$,name:[S,"level"],label:"等级",rules:[{required:!0,message:"请输入等级"}],children:e.jsx(M,{min:1,max:5,disabled:!0,style:{width:"100%"}})})}),e.jsx(h,{span:16,children:e.jsx(c.Item,{...$,name:[S,"rate"],label:"佣金比例(%)",rules:[{required:!0,message:"请输入佣金比例"},{type:"number",min:0,max:100,message:"佣金比例必须在0-100之间"}],children:e.jsx(M,{min:0,max:100,precision:2,step:.1,style:{width:"100%"}})})})]},j))})}),e.jsx(c.Item,{children:e.jsxs(V,{className:"float-right",children:[e.jsx(u,{onClick:()=>d(!1),children:"取消"}),e.jsx(u,{type:"primary",htmlType:"submit",loading:m,children:"保存设置"})]})})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{children:"暂无邀请数据，请点击加载按钮"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",onClick:k,type:"button",children:"加载邀请数据"})]})})},{Title:_}=ee,{TabPane:q}=te;function Pe(){const s=de().id,p=xe(),[i,I]=o.useState(null),[C,d]=o.useState(!0);return o.useEffect(()=>{if(!s){x.error("用户ID无效"),p("/user");return}async function v(){d(!0);try{const m=await ge(s);I(m),console.log(`成功获取用户 ${s} 的信息:`,m)}catch(m){console.error(`获取用户 ${s} 详情失败:`,m),x.error("获取用户详情失败，请稍后重试")}finally{d(!1)}}v()},[s,p]),C?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(G,{size:"large",tip:"正在加载用户详情..."})}):i?e.jsxs("div",{className:"p-6",children:[e.jsxs(_,{level:3,className:"mb-6",children:["用户详情:"," ",i.username]}),e.jsxs(te,{defaultActiveKey:"basic",children:[e.jsx(q,{tab:"基本信息",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"用户ID:"})," ",i.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"用户名:"})," ",i.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"昵称:"})," ",i.nickname||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"邮箱:"})," ",i.email||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"等级:"})," ",i.level]}),e.jsxs("p",{children:[e.jsx("strong",{children:"性别:"})," ",i.gender||"-"]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"注册时间:"})," ",new Date(i.createdAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"最后活跃:"})," ",i.lastActiveAt?new Date(i.lastActiveAt).toLocaleString():"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"头像URL:"})," ",i.avatarUrl||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"个人简介:"})," ",i.bio||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"生日:"})," ",i.birthday||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"地区:"})," ",i.location||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"邀请码:"})," ",i.invitationCode||"-"]})]})]})},"basic"),e.jsx(q,{tab:"钱包",children:e.jsx(ke,{userId:s})},"wallet"),e.jsx(q,{tab:"邀请",children:e.jsx(Ne,{userId:s})},"invite")]})]}):e.jsx("div",{className:"p-6 text-center",children:e.jsx(_,{level:4,children:"无法加载用户信息"})})}export{Pe as default};
