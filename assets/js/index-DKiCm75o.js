import{u as H,j as e}from"./index-1ZBto_-g.js";import{r as i}from"./react-Dz_Dwpfc.js";import{A as d}from"./admin-service-CvuEQWz8.js";import{B as Q}from"./BatchDeleteButton-CUrkqy2a.js";import{C as U}from"./CreateButton-9qnTe-OE.js";import{E as W,D as X}from"./EditButton-Deu_r6KD.js";import{S as Z,a as b,b as ee,R as te}from"./SearchRow-xPyHfxeX.js";import{S as ae}from"./SearchContainer-ByDaU2FD.js";import{u as se,a as re,S as le}from"./useTable-BVSyg1JY.js";import{A as ne,F as s,I as c,a as oe,k as C,q as ie,E as w,j as T,S as h,r as l,p as D,B as f}from"./antd-CXRY_8Ve.js";import"./echarts-C9Czxobr.js";import"./sdk-service-YB3zOGM1.js";import"./Button-BDuz2NeE.js";import"./useWindowSize-DSNN33pu.js";import"./useMutation-BJrKfVbk.js";import"./usePageTransfer-C2Wz5ZHh.js";function Ce(){const{t:a}=H(),E=i.useRef(null),{message:o}=ne.useApp(),[F,u]=i.useState(!1),[q,p]=i.useState(!1),[j]=s.useForm(),[y]=s.useForm(),[P,M]=i.useState([]),[S,x]=i.useState(!1),[g,N]=i.useState(null);i.useEffect(()=>{(async()=>{try{const r=await d.getAllModels();M(r.map(n=>({id:n.id,name:n.name||n.id})))}catch(r){console.error("获取模型列表失败:",r),o.error("获取模型列表失败")}})()},[o]),i.useEffect(()=>{const t=localStorage.getItem("user.token");console.log("当前token状态:",t?"已存在":"不存在",t?`${t.substring(0,15)}...`:"")},[]);async function v({page:t,pageSize:r}){console.log("正在请求参数列表...",{page:t,pageSize:r});try{const n=await d.getAllParameters(t,r);return console.log("参数列表获取成功:",n),{list:n,total:n.length}}catch(n){return console.error("获取参数列表失败:",n),n instanceof Error?o.error(`获取参数列表失败: ${n.message}`):o.error("获取参数列表失败: 未知错误"),{list:[],total:0}}}const{listContainerProps:K,tableScrollY:A}=se(),m=t=>{if(t===null)return"-";try{return JSON.stringify(t)}catch{return String(t)}},{form:B,tableProps:R,isLoading:V,selectedIsEmpty:L,selectedCount:O,handleReset:k}=re({key:"model-parameter-list",pagination:!0,listApiFn:v,scrollY:A,selectable:!0,formInitialValues:{parameterSetName:null,modelId:null,notes:null},columns:[{title:a("参数集名称"),dataIndex:"parameterSetName"},{title:a("模型ID"),dataIndex:"modelId"},{title:a("备注"),dataIndex:"notes",render:m},{title:a("温度参数"),dataIndex:"temperature",render:m},{title:a("最大Token数"),dataIndex:"maxTokens",render:m},{title:a("顶部概率采样"),dataIndex:"topP",render:m},{title:a("顶部K采样"),dataIndex:"topK",render:m},{title:a("频率惩罚"),dataIndex:"frequencyPenalty",render:m},{title:a("存在惩罚"),dataIndex:"presencePenalty",render:m},{title:a("是否默认"),dataIndex:"isDefault",render:t=>a(t?"是":"否")},{title:a("操作"),key:"actions",fixed:"right",width:100,render:(t,r)=>e.jsxs(e.Fragment,{children:[e.jsx(W,{type:"text",size:"small",noText:!0,onClick:()=>_(r)}),e.jsx(X,{type:"text",size:"small",noText:!0,onConfirm:()=>Y(r.id)})]})}]}),I=()=>{k()};function _(t){N(t),y.setFieldsValue({parameterSetName:t.parameterSetName,modelId:t.modelId,notes:t.notes,temperature:t.temperature,maxTokens:t.maxTokens,topP:t.topP,topK:t.topK,frequencyPenalty:t.frequencyPenalty,presencePenalty:t.presencePenalty,isDefault:t.isDefault}),p(!0)}async function J(){try{if(!g)return;const t=await y.validateFields();x(!0);const r={temperature:t.temperature,maxTokens:t.maxTokens,topP:t.topP,topK:t.topK,frequencyPenalty:t.frequencyPenalty,presencePenalty:t.presencePenalty,isDefault:t.isDefault,notes:t.notes};await d.updateModelParameter(g.id,r),o.success(a("更新成功")),p(!1),I()}catch(t){console.error("更新参数集失败:",t),o.error(a("更新失败"))}finally{x(!1)}}async function Y(t){try{await d.deleteModelParameter(t),o.success(a("删除成功")),I()}catch(r){console.error("删除参数集失败:",r),o.error(a("删除失败"))}}const $=e.jsx(s,{ref:E,form:B,colon:!1,autoComplete:"off",onFinish:()=>{},children:e.jsx(ae,{actions:e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsx(ee,{loading:V}),e.jsx(te,{onClick:k})]}),e.jsx(C,{type:"vertical"}),e.jsx(Q,{disabled:L,count:O,onConfirm:()=>{}}),e.jsx(C,{type:"vertical"}),e.jsx(U,{onClick:()=>z()})]}),children:e.jsxs(Z,{children:[e.jsx(b,{name:"parameterSetName",label:a("参数集名称"),children:e.jsx(c,{})}),e.jsx(b,{name:"modelId",label:a("模型ID"),children:e.jsx(c,{})}),e.jsx(b,{name:"notes",label:a("备注"),children:e.jsx(c,{})})]})})});function z(){j.resetFields(),u(!0)}async function G(){try{const t=await j.validateFields();x(!0);const r={parameterSetName:t.parameterSetName,modelId:t.modelId,temperature:t.temperature,maxTokens:t.maxTokens,topP:t.topP,topK:t.topK,frequencyPenalty:t.frequencyPenalty,presencePenalty:t.presencePenalty,isDefault:t.isDefault,notes:t.notes};await d.createModelParameter(r),o.success(a("创建成功")),u(!1),I()}catch(t){console.error("创建参数集失败:",t),o.error(a("创建失败"))}finally{x(!1)}}return e.jsxs(e.Fragment,{children:[e.jsx(le,{...K,searchForm:$,children:e.jsx(ie,{...R,locale:{emptyText:e.jsx(w,{description:a("暂无参数数据"),image:w.PRESENTED_IMAGE_SIMPLE})}})}),e.jsx(T,{title:a("创建参数集"),open:F,onCancel:()=>u(!1),footer:[e.jsx(f,{onClick:()=>u(!1),children:a("取消")},"cancel"),e.jsx(f,{type:"primary",loading:S,onClick:G,children:a("确定")},"submit")],children:e.jsxs(s,{form:j,layout:"vertical",autoComplete:"off",children:[e.jsx(s.Item,{name:"parameterSetName",label:a("参数集名称"),rules:[{required:!0,message:a("请输入参数集名称")}],children:e.jsx(c,{placeholder:a("请输入参数集名称")})}),e.jsx(s.Item,{name:"modelId",label:a("模型"),rules:[{required:!0,message:a("请选择模型")}],children:e.jsx(h,{placeholder:a("请选择模型"),children:P.map(t=>e.jsx(h.Option,{value:t.id,children:t.name},t.id))})}),e.jsx(s.Item,{name:"notes",label:a("备注"),children:e.jsx(c,{placeholder:a("请输入备注")})}),e.jsx(s.Item,{name:"temperature",label:a("温度参数"),children:e.jsx(l,{min:0,max:2,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"maxTokens",label:a("最大Token数"),children:e.jsx(l,{min:1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"topP",label:a("顶部概率采样"),children:e.jsx(l,{min:0,max:1,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"topK",label:a("顶部K采样"),children:e.jsx(l,{min:0,style:{width:"100%"}})}),e.jsx(s.Item,{name:"frequencyPenalty",label:a("频率惩罚"),children:e.jsx(l,{min:0,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"presencePenalty",label:a("存在惩罚"),children:e.jsx(l,{min:0,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"isDefault",label:a("是否默认"),valuePropName:"checked",initialValue:!1,children:e.jsx(D,{})})]})}),e.jsx(T,{title:a("编辑参数集"),open:q,onCancel:()=>p(!1),footer:[e.jsx(f,{onClick:()=>p(!1),children:a("取消")},"cancel"),e.jsx(f,{type:"primary",loading:S,onClick:J,children:a("确定")},"submit")],children:e.jsxs(s,{form:y,layout:"vertical",autoComplete:"off",children:[e.jsx(s.Item,{name:"parameterSetName",label:a("参数集名称"),rules:[{required:!0,message:a("请输入参数集名称")}],children:e.jsx(c,{placeholder:a("请输入参数集名称"),disabled:!0})}),e.jsx(s.Item,{name:"modelId",label:a("模型"),rules:[{required:!0,message:a("请选择模型")}],children:e.jsx(h,{placeholder:a("请选择模型"),disabled:!0,children:P.map(t=>e.jsx(h.Option,{value:t.id,children:t.name},t.id))})}),e.jsx(s.Item,{name:"notes",label:a("备注"),children:e.jsx(c,{placeholder:a("请输入备注")})}),e.jsx(s.Item,{name:"temperature",label:a("温度参数"),children:e.jsx(l,{min:0,max:2,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"maxTokens",label:a("最大Token数"),children:e.jsx(l,{min:1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"topP",label:a("顶部概率采样"),children:e.jsx(l,{min:0,max:1,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"topK",label:a("顶部K采样"),children:e.jsx(l,{min:0,style:{width:"100%"}})}),e.jsx(s.Item,{name:"frequencyPenalty",label:a("频率惩罚"),children:e.jsx(l,{min:0,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"presencePenalty",label:a("存在惩罚"),children:e.jsx(l,{min:0,step:.1,style:{width:"100%"}})}),e.jsx(s.Item,{name:"isDefault",label:a("是否默认"),valuePropName:"checked",children:e.jsx(D,{})})]})})]})}export{Ce as default};
