import{u as N,j as e}from"./index-Db-n9AuA.js";import{r as c,L as Y}from"./react-DNsX-D9n.js";import{A as d}from"./admin-service-CklKH5OV.js";import{B as J}from"./BatchDeleteButton-Bt_weDdV.js";import{C as Q}from"./CreateButton-DdPtt1jh.js";import{D as W}from"./DeleteButton-BMniQVoK.js";import{E as X}from"./EditButton-BUedPtj1.js";import{S as Z,a as y,b as ee,R as re}from"./SearchRow-q_BHF2rT.js";import{S as te}from"./SearchContainer-BiQmlDqb.js";import{u as se,a as le,S as ae}from"./useTable-fH3mNaAk.js";import{A as ie,F as a,T as g,I as o,S as s,a as ne,f as P,o as oe,K as S,g as T,B as u}from"./antd-Bzi-nNZC.js";import"./echarts-C9Czxobr.js";import"./Button-_vf7nIrW.js";import"./useWindowSize-CaV-WCuS.js";import"./useMutation-DP40qn5U.js";import"./usePageTransfer-d_dI9PVS.js";function Pe(){const{t:r}=N(),k=c.useRef(null),{modal:O,message:i}=ie.useApp(),[w,p]=c.useState(!1),[E,h]=c.useState(!1),[m,F]=c.useState(null),[j]=a.useForm(),[f]=a.useForm(),[I,x]=c.useState(!1);c.useEffect(()=>{const t=localStorage.getItem("user.token");console.log("当前token状态:",t?"已存在":"不存在",t?`${t.substring(0,15)}...`:"")},[]);async function U({page:t,pageSize:l}){console.log("正在请求供应商列表...",{page:t,pageSize:l});try{const n=await d.getAllProviders();return console.log("供应商列表获取成功:",n),{list:n,total:n.length}}catch(n){return console.error("获取供应商列表失败:",n),n instanceof Error?i.error(`获取供应商列表失败: ${n.message}`):i.error("获取供应商列表失败: 未知错误"),{list:[],total:0}}}const{listContainerProps:L,tableScrollY:b}=se(),{form:R,tableProps:B,isLoading:D,selectedIsEmpty:V,selectedCount:M,handleReset:C}=le({key:"provider-list",pagination:!0,listApiFn:U,scrollY:b,selectable:!0,formInitialValues:{name:null,providerType:null,status:null},columns:[{title:r("供应商ID"),dataIndex:"id",render:t=>e.jsx(Y,{to:`/modelprovider/${t}`,children:t})},{title:r("供应商名称"),dataIndex:"name"},{title:r("描述"),dataIndex:"description",ellipsis:!0},{title:r("供应商类型"),dataIndex:"providerType",render:t=>e.jsx(g,{color:"processing",children:t})},{title:r("认证类型"),dataIndex:"authType",render:t=>e.jsx(g,{color:"blue",children:t})},{title:r("API基础URL"),dataIndex:"apiBaseUrl",ellipsis:!0},{title:r("状态"),dataIndex:"status",render:t=>e.jsx(g,{color:t==="ACTIVE"?"success":"warning",children:t})},{title:r("创建时间"),dataIndex:"createdAt",render:t=>new Date(t).toLocaleString()},{title:r("操作"),key:"actions",fixed:"right",width:120,render:(t,l)=>e.jsxs(e.Fragment,{children:[e.jsx(X,{type:"text",size:"small",noText:!0,onClick:()=>_(l)}),e.jsx(W,{type:"text",size:"small",noText:!0,onConfirm:()=>G(l.id)})]})}]}),v=()=>{C()};function _(t){F(t),f.setFieldsValue({name:t.name,description:t.description,websiteUrl:t.websiteUrl,apiDocUrl:t.apiDocUrl,apiBaseUrl:t.apiBaseUrl,authType:t.authType,providerType:t.providerType}),h(!0)}async function q(){if(m)try{const t=await f.validateFields();x(!0),await d.updateProvider(m.id,t),i.success(r("更新成功")),h(!1),v()}catch(t){console.error("更新供应商失败:",t),i.error(r("更新失败"))}finally{x(!1)}}async function G(t){try{await d.deleteProvider(t),i.success(r("删除成功")),v()}catch(l){console.error("删除供应商失败:",l),i.error(r("删除失败"))}}async function $(t){try{const l=await d.checkProviderHealth(t);O.success({title:r("健康状态检查"),content:e.jsxs("div",{children:[e.jsxs("p",{children:[r("状态"),":"," ",l.message?r("健康"):r("不健康")]}),e.jsxs("p",{children:[r("消息"),":"," ",l.message||r("无详细信息")]})]})})}catch(l){console.error("检查供应商健康状态失败:",l),i.error(r("健康状态检查失败"))}}const z=e.jsx(a,{ref:k,form:R,colon:!1,autoComplete:"off",onFinish:()=>{},children:e.jsx(te,{actions:e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(ee,{loading:D}),e.jsx(re,{onClick:C})]}),e.jsx(P,{type:"vertical"}),e.jsx(J,{disabled:V,count:M,onConfirm:()=>{}}),e.jsx(P,{type:"vertical"}),e.jsx(Q,{onClick:()=>H()})]}),children:e.jsxs(Z,{children:[e.jsx(y,{name:"name",label:r("供应商名称"),children:e.jsx(o,{})}),e.jsx(y,{name:"providerType",label:r("供应商类型"),children:e.jsxs(s,{allowClear:!0,children:[e.jsx(s.Option,{value:"openai",children:r("OpenAI")}),e.jsx(s.Option,{value:"anthropic",children:r("Anthropic")}),e.jsx(s.Option,{value:"cohere",children:r("Cohere")}),e.jsx(s.Option,{value:"mistralai",children:r("Mistral")}),e.jsx(s.Option,{value:"deepseek",children:r("Deepseek")}),e.jsx(s.Option,{value:"google",children:r("Google")}),e.jsx(s.Option,{value:"custom",children:r("自定义")})]})}),e.jsx(y,{name:"status",label:r("状态"),children:e.jsxs(s,{allowClear:!0,children:[e.jsx(s.Option,{value:"ACTIVE",children:r("活跃")}),e.jsx(s.Option,{value:"INACTIVE",children:r("不活跃")})]})})]})})});function H(){j.resetFields(),p(!0)}async function K(){try{const t=await j.validateFields();x(!0),await d.createProvider(t),i.success(r("创建成功")),p(!1),v()}catch(t){console.error("创建供应商失败:",t),i.error(r("创建失败"))}finally{x(!1)}}const A=(t,l=!1)=>e.jsxs(a,{form:t,layout:"vertical",autoComplete:"off",children:[e.jsx(a.Item,{name:"name",label:r("供应商名称"),rules:[{required:!0,message:r("请输入供应商名称")}],children:e.jsx(o,{placeholder:r("请输入供应商名称")})}),e.jsx(a.Item,{name:"description",label:r("供应商描述"),children:e.jsx(o.TextArea,{placeholder:r("请输入供应商描述")})}),e.jsx(a.Item,{name:"websiteUrl",label:r("官网URL"),children:e.jsx(o,{placeholder:r("请输入官网URL")})}),e.jsx(a.Item,{name:"apiDocUrl",label:r("API文档URL"),children:e.jsx(o,{placeholder:r("请输入API文档URL")})}),e.jsx(a.Item,{name:"apiKey",label:r("API密钥"),rules:[{required:!l,message:r("请输入API密钥")}],children:e.jsx(o.Password,{placeholder:r(l?"留空表示不修改":"请输入API密钥")})}),e.jsx(a.Item,{name:"apiBaseUrl",label:r("API基础URL"),children:e.jsx(o,{placeholder:r("请输入API基础URL")})}),e.jsx(a.Item,{name:"authType",label:r("认证类型"),rules:[{required:!0,message:r("请选择认证类型")}],initialValue:"api_key",children:e.jsxs(s,{children:[e.jsx(s.Option,{value:"api_key",children:r("API密钥")}),e.jsx(s.Option,{value:"oauth",children:r("OAuth")}),e.jsx(s.Option,{value:"custom",children:r("自定义")})]})}),e.jsx(a.Item,{name:"providerType",label:r("供应商类型"),rules:[{required:!0,message:r("请选择供应商类型")}],initialValue:"custom",children:e.jsxs(s,{children:[e.jsx(s.Option,{value:"openai",children:r("OpenAI")}),e.jsx(s.Option,{value:"anthropic",children:r("Anthropic")}),e.jsx(s.Option,{value:"cohere",children:r("Cohere")}),e.jsx(s.Option,{value:"mistralai",children:r("Mistral")}),e.jsx(s.Option,{value:"deepseek",children:r("Deepseek")}),e.jsx(s.Option,{value:"google",children:r("Google")}),e.jsx(s.Option,{value:"custom",children:r("自定义")})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(ae,{...L,searchForm:z,children:e.jsx(oe,{...B,locale:{emptyText:e.jsx(S,{description:r("暂无供应商数据"),image:S.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1500,y:b}})}),e.jsx(T,{title:r("创建供应商"),open:w,onCancel:()=>p(!1),footer:[e.jsx(u,{onClick:()=>p(!1),children:r("取消")},"cancel"),e.jsx(u,{type:"primary",loading:I,onClick:K,children:r("确定")},"submit")],width:600,children:A(j)}),e.jsx(T,{title:r("编辑供应商"),open:E,onCancel:()=>h(!1),footer:[e.jsx(u,{onClick:()=>h(!1),children:r("取消")},"cancel"),e.jsx(u,{type:"primary",loading:I,onClick:q,children:r("确定")},"submit"),e.jsx(u,{type:"default",onClick:()=>m&&$(m.id),children:r("检查健康状态")},"health")],width:600,children:A(f,!0)})]})}export{Pe as default};
