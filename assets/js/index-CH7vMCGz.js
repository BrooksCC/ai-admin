import{u as z,j as t}from"./index-Cj6qzBOg.js";import{m as G,u as H,r as c}from"./react-Dz_Dwpfc.js";import{A as u}from"./admin-service-JyHIzBt2.js";import{B as J}from"./BackButton-D9fs4pgJ.js";import{C as Q}from"./CreateButton-BMtQHYEL.js";import{E as W,D as X}from"./EditButton-BaG7pNgk.js";import{u as Z,a as ee,S as te}from"./useTable-BauLLx5n.js";import{A as re,F as l,c as ie,w as se,q as ne,E as I,a as oe,B as d,j as K,I as ae,r as E,S as P}from"./antd-CXRY_8Ve.js";import"./echarts-C9Czxobr.js";import"./sdk-service-CwzZtY5O.js";import"./Button-DhR-ObkO.js";import"./useWindowSize-DSNN33pu.js";import"./useMutation-CQ0bx9B4.js";import"./usePageTransfer-D54nfR-X.js";function D(r){switch(r){case"USD":return"$";case"CNY":return"Â¥";case"EUR":return"â‚¬";case"SCORE":return"ğŸ”¢";default:return""}}function Ce(){const{t:r}=z(),{id:s}=G(),w=H(),{message:o}=re.useApp(),[F,p]=c.useState(!1),[k,m]=c.useState(!1),[y,v]=c.useState(null),[h]=l.useForm(),[x]=l.useForm(),[j,g]=c.useState(!1),[a,T]=c.useState(null),[M,S]=c.useState(!0);c.useEffect(()=>{s&&A()},[s]);const A=async()=>{if(s)try{S(!0);const e=await u.getProvider(s);T(e)}catch(e){console.error("è·å–ä¾›åº”å•†è¯¦æƒ…å¤±è´¥:",e),o.error(r("è·å–ä¾›åº”å•†è¯¦æƒ…å¤±è´¥"))}finally{S(!1)}};async function B(){if(!s)return{list:[],total:0};try{console.log("æ­£åœ¨è¯·æ±‚ä¾›åº”å•†ä»·æ ¼åˆ—è¡¨...",{providerId:s});const e=await u.getProviderPricings(s);return console.log("ä¾›åº”å•†ä»·æ ¼åˆ—è¡¨è·å–æˆåŠŸ:",e),{list:e,total:e.length}}catch(e){return console.error("è·å–ä¾›åº”å•†ä»·æ ¼åˆ—è¡¨å¤±è´¥:",e),e instanceof Error?o.error(`è·å–ä¾›åº”å•†ä»·æ ¼åˆ—è¡¨å¤±è´¥: ${e.message}`):o.error("è·å–ä¾›åº”å•†ä»·æ ¼åˆ—è¡¨å¤±è´¥: æœªçŸ¥é”™è¯¯"),{list:[],total:0}}}const{listContainerProps:V,tableScrollY:C}=Z(),{tableProps:L,isLoading:R,handleReset:U}=ee({key:"provider-pricing-list",pagination:!0,listApiFn:B,scrollY:C,selectable:!0,formInitialValues:{},columns:[{title:r("ä»·æ ¼ID"),dataIndex:"id"},{title:r("æ¨¡å‹ID"),dataIndex:"modelId"},{title:r("è¾“å…¥ä»·æ ¼"),dataIndex:"inputPricePerK",render:(e,i)=>{let n="";return typeof e=="object"&&e!==null?n=e.toString():typeof e=="string"?n=e:n=String(e),`${D(i.currencyCode)}${n} / 1K tokens`}},{title:r("è¾“å‡ºä»·æ ¼"),dataIndex:"outputPricePerK",render:(e,i)=>{let n="";return typeof e=="object"&&e!==null?n=e.toString():typeof e=="string"?n=e:n=String(e),`${D(i.currencyCode)}${n} / 1K tokens`}},{title:r("è´§å¸"),dataIndex:"currencyCode"},{title:r("åˆ›å»ºæ—¶é—´"),dataIndex:"createdAt",render:e=>new Date(e).toLocaleString()},{title:r("æ“ä½œ"),key:"actions",fixed:"right",width:120,render:(e,i)=>t.jsxs(t.Fragment,{children:[t.jsx(W,{type:"text",size:"small",noText:!0,onClick:()=>N(i)}),t.jsx(X,{type:"text",size:"small",noText:!0,onConfirm:()=>q(i.id)})]})}]}),f=()=>{U()};function N(e){v(e);const i=typeof e.inputPricePerK=="object"?e.inputPricePerK.toString():String(e.inputPricePerK),n=typeof e.outputPricePerK=="object"?e.outputPricePerK.toString():String(e.outputPricePerK);x.setFieldsValue({modelId:e.modelId,inputPricePerK:i,outputPricePerK:n,currencyCode:e.currencyCode}),m(!0)}async function $(){if(y)try{const e=await x.validateFields();g(!0);const i={...e,inputPricePerK:String(e.inputPricePerK),outputPricePerK:String(e.outputPricePerK)};await u.updateModelPricing(y.id,i),o.success(r("æ›´æ–°æˆåŠŸ")),m(!1),f()}catch(e){console.error("æ›´æ–°ä»·æ ¼è®°å½•å¤±è´¥:",e),o.error(r("æ›´æ–°å¤±è´¥"))}finally{g(!1)}}async function q(e){if(s)try{await u.deleteModelPricing(s,e),o.success(r("åˆ é™¤æˆåŠŸ")),f()}catch(i){console.error("åˆ é™¤ä»·æ ¼è®°å½•å¤±è´¥:",i),o.error(r("åˆ é™¤å¤±è´¥"))}}function Y(){h.resetFields(),p(!0)}async function O(){if(s)try{const e=await h.validateFields();g(!0);const i={...e,providerId:s,inputPricePerK:String(e.inputPricePerK),outputPricePerK:String(e.outputPricePerK)};await u.createModelPricing(i),o.success(r("åˆ›å»ºæˆåŠŸ")),p(!1),f()}catch(e){console.error("åˆ›å»ºä»·æ ¼è®°å½•å¤±è´¥:",e),o.error(r("åˆ›å»ºå¤±è´¥"))}finally{g(!1)}}const b=e=>t.jsxs(l,{form:e,layout:"vertical",autoComplete:"off",children:[t.jsx(l.Item,{name:"modelId",label:r("æ¨¡å‹ID"),rules:[{required:!0,message:r("è¯·è¾“å…¥æ¨¡å‹ID")}],children:t.jsx(ae,{placeholder:r("è¯·è¾“å…¥æ¨¡å‹ID")})}),t.jsx(l.Item,{name:"inputPricePerK",label:r("è¾“å…¥ä»·æ ¼ (æ¯1K tokens)"),rules:[{required:!0,message:r("è¯·è¾“å…¥è¾“å…¥ä»·æ ¼")}],children:t.jsx(E,{style:{width:"100%"},placeholder:r("è¯·è¾“å…¥è¾“å…¥ä»·æ ¼"),min:0,step:1e-4,precision:6,stringMode:!0})}),t.jsx(l.Item,{name:"outputPricePerK",label:r("è¾“å‡ºä»·æ ¼ (æ¯1K tokens)"),rules:[{required:!0,message:r("è¯·è¾“å…¥è¾“å‡ºä»·æ ¼")}],children:t.jsx(E,{style:{width:"100%"},placeholder:r("è¯·è¾“å…¥è¾“å‡ºä»·æ ¼"),min:0,step:1e-4,precision:6,stringMode:!0})}),t.jsx(l.Item,{name:"currencyCode",label:r("è´§å¸"),rules:[{required:!0,message:r("è¯·é€‰æ‹©è´§å¸")}],initialValue:"USD",children:t.jsxs(P,{children:[t.jsx(P.Option,{value:"USD",children:"USD"}),t.jsx(P.Option,{value:"CNY",children:"CNY"}),t.jsx(P.Option,{value:"EUR",children:"EUR"})]})})]});return t.jsxs(t.Fragment,{children:[t.jsx(ie,{title:r("ä¾›åº”å•†ä¿¡æ¯"),style:{marginBottom:16},loading:M,extra:t.jsx(J,{onClick:()=>w("/modelprovider")}),children:a&&t.jsxs("div",{children:[t.jsxs("p",{children:[t.jsxs("strong",{children:[r("ID"),":"]})," ",a.id]}),t.jsxs("p",{children:[t.jsxs("strong",{children:[r("åç§°"),":"]})," ",a.name]}),t.jsxs("p",{children:[t.jsxs("strong",{children:[r("ç±»å‹"),":"]})," ",a.providerType]}),a.status&&t.jsxs("p",{children:[t.jsxs("strong",{children:[r("çŠ¶æ€"),":"]})," ",t.jsx(se,{color:a.status==="ACTIVE"?"success":"warning",children:a.status})]})]})}),t.jsx(te,{...V,searchForm:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16},children:[t.jsx("h2",{children:r("ä»·æ ¼è®°å½•")}),t.jsxs(oe,{children:[t.jsx(d,{onClick:f,loading:R,children:r("åˆ·æ–°")}),t.jsx(Q,{onClick:Y})]})]}),children:t.jsx(ne,{...L,locale:{emptyText:t.jsx(I,{description:r("æš‚æ— ä»·æ ¼è®°å½•"),image:I.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1e3,y:C}})}),t.jsx(K,{title:r("åˆ›å»ºä»·æ ¼è®°å½•"),open:F,onCancel:()=>p(!1),footer:[t.jsx(d,{onClick:()=>p(!1),children:r("å–æ¶ˆ")},"cancel"),t.jsx(d,{type:"primary",loading:j,onClick:O,children:r("ç¡®å®š")},"submit")],width:600,children:b(h)}),t.jsx(K,{title:r("ç¼–è¾‘ä»·æ ¼è®°å½•"),open:k,onCancel:()=>m(!1),footer:[t.jsx(d,{onClick:()=>m(!1),children:r("å–æ¶ˆ")},"cancel"),t.jsx(d,{type:"primary",loading:j,onClick:$,children:r("ç¡®å®š")},"submit")],width:600,children:b(x)})]})}export{Ce as default};
