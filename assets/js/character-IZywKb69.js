import{D as or,d as g,x as sr}from"./index-JkWopOOq.js";import{A as lr}from"./admin-service-BKkQARFc.js";var cr;let ir;function hr(e,r,t,a,l,J){var S,c,T,_,E,F,A,W=Symbol.metadata||Symbol.for("Symbol.metadata"),$=Object.defineProperty,x=Object.create,n=[x(null),x(null)],i=r.length;function I(o,w,y){return function(s,u){w&&(u=s,s=e);for(var m=0;m<o.length;m++)u=o[m].apply(s,y?[u]:[]);return y?u:s}}function p(o,w,y,s){if(typeof o!="function"&&(s||o!==void 0))throw new TypeError(w+" must "+(y||"be")+" a function"+(s?"":" or undefined"));return o}function O(o,w,y,s,u,m,j,v,C,b,Z){function L(d){if(!Z(d))throw new TypeError("Attempted to access private element on non-instance")}var M=[].concat(w[0]),P=w[3],G=!j,B=u===1,H=u===3,N=u===4,z=u===2;function U(d,R,tr){return function(k,ar){return R&&(ar=k,k=o),tr&&tr(k),h[d].call(k,ar)}}if(!G){var h={},Q=[],D=H?"get":N||B?"set":"value";if(C?(b||B?h={get:nr(function(){return P(this)},s,"get"),set:function(d){w[4](this,d)}}:h[D]=P,b||nr(h[D],s,z?"":D)):b||(h=Object.getOwnPropertyDescriptor(o,s)),!b&&!C){if((c=n[+v][s])&&(c^u)!=7)throw Error("Decorating two elements with the same name ("+h[D].name+") is not supported yet");n[+v][s]=u<3?1:u}}for(var f=o,K=M.length-1;K>=0;K-=y?2:1){var rr=p(M[K],"A decorator","be",!0),er=y?M[K-1]:void 0,V={},q={kind:["field","accessor","method","getter","setter","class"][u],name:s,metadata:S,addInitializer:(function(d,R){if(d.v)throw new TypeError("attempted to call addInitializer after decoration was finished");p(R,"An initializer","be",!0),m.push(R)}).bind(null,V)};if(G)c=rr.call(er,f,q),V.v=1,p(c,"class decorators","return")&&(f=c);else if(q.static=v,q.private=C,c=q.access={has:C?Z.bind():function(d){return s in d}},N||(c.get=C?z?function(d){return L(d),h.value}:U("get",0,L):function(d){return d[s]}),z||H||(c.set=C?U("set",0,L):function(d,R){d[s]=R}),f=rr.call(er,B?{get:h.get,set:h.set}:h[D],q),V.v=1,B){if(typeof f=="object"&&f)(c=p(f.get,"accessor.get"))&&(h.get=c),(c=p(f.set,"accessor.set"))&&(h.set=c),(c=p(f.init,"accessor.init"))&&Q.unshift(c);else if(f!==void 0)throw new TypeError("accessor decorators must return an object with get, set, or init properties or undefined")}else p(f,(b?"field":"method")+" decorators","return")&&(b?Q.unshift(f):h[D]=f)}return u<2&&j.push(I(Q,v,1),I(m,v,0)),b||G||(C?B?j.splice(-1,0,U("get",v),U("set",v)):j.push(z?h[D]:p.call.bind(h[D])):$(o,s,h)),f}function Y(o){return $(o,W,{configurable:!0,enumerable:!0,value:S})}return S=x(S??null),E=[],F=function(o){o&&E.push(I(o))},A=function(o,w){for(var y=0;y<t.length;y++){var s=t[y],u=s[1],m=7&u;if((8&u)==o&&!m==w){var j=s[2],v=!!s[3],C=16&u;O(o?e:e.prototype,s,C,v?"#"+j:dr(j),m,m<2?[]:o?_=_||[]:T=T||[],E,!!o,v,w,o&&v?function(b){return fr(b)===e}:l)}}},A(8,0),A(0,0),A(8,1),A(0,1),F(T),F(_),c=E,i||Y(e),{e:c,get c(){var o=[];return i&&[Y(e=O(e,[r],a,e.name,5,o)),I(o,1)]}}}function dr(e){var r=pr(e,"string");return typeof r=="symbol"?r:r+""}function pr(e,r){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,r);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function nr(e,r,t){typeof r=="symbol"&&(r=(r=r.description)?"["+r+"]":"");try{Object.defineProperty(e,"name",{configurable:!0,value:t?t+" "+r:r})}catch{}return e}function fr(e){if(Object(e)!==e)throw TypeError("right-hand side of 'in' should be an object, got "+(e!==null?typeof e:"null"));return e}let ur;class gr{async create(r){try{return(await g.characters.create({createCharacterRequestDto:r})).data}catch(t){throw console.error("Failed to create character:",t),t}}async favoriteCharacter(r){try{await g.characters.favoriteCharacter({id:r})}catch(t){throw console.error("Failed to favorite character:",t),t}}async findUserFavorites(r,t,a){try{return(await g.characters.findUserFavorites({userId:r,page:t,limit:a})).data}catch(l){throw console.error("Failed to find user favorites:",l),l}}async getAllCategoriesWithPopularTags(){try{return(await g.characters.getAllCategoriesWithPopularTags()).data}catch(r){throw console.error("Failed to get all categories with popular tags:",r),r}}async getCharacterDetail(r){try{return(await g.characters.getCharacterDetail({id:r})).data}catch(t){throw console.error("Failed to get character detail:",t),t}}async getRatings(r,t,a){try{return(await g.characters.getRatings({id:r,page:t,limit:a})).data}catch(l){throw console.error("Failed to get ratings:",l),l}}async importCharacter(r,t){try{return(await g.characters.importCharacter({format:r,preservedFileName:t})).data}catch(a){throw console.error("Failed to import character:",a),a}}async rateCharacter(r,t){try{return(await g.characters.rateCharacter({id:r,rateCharacterRequestDto:t})).data}catch(a){throw console.error("Failed to rate character:",a),a}}async remove(r){try{await g.characters.remove({id:r})}catch(t){throw console.error("Failed to remove character:",t),t}}async searchCharacters(r,t,a={}){try{return(await g.characters.searchCharacters({page:r,limit:t,...a})).data}catch(l){throw console.error("Failed to search characters:",l),l}}async unfavoriteCharacter(r){try{await g.characters.unfavoriteCharacter({id:r})}catch(t){throw console.error("Failed to unfavorite character:",t),t}}async update(r,t){try{return(await g.characters.update({id:r,updateCharacterRequestDto:t})).data}catch(a){throw console.error("Failed to update character:",a),a}}}cr=gr;[ur,ir]=hr(cr,[or,or.Singleton],[],1).c;ir();const X=new ur,yr="https://bvyw4dvnxe.ap-southeast-1.awsapprunner.com";async function mr(e){try{const r={page:e.page||1,limit:e.limit||20,search:e.search||void 0,visibility:e.visibility?e.visibility:void 0,status:e.status?e.status:void 0,creatorId:e.creatorId||void 0,categoryId:e.categoryId||void 0,categoryIds:e.categoryIds||void 0,tags:e.tags||void 0,sortBy:e.sortBy||"popularity",sortOrder:e.sortOrder||"desc"},t=await lr.getAllCharacters(r);return{characters:t.items||[],totalCount:t.total||0}}catch(r){throw console.error("Error in searchCharacters:",r),r}}function Cr(e){return X.getCharacterDetail(e)}function br(e,r){return X.update(e,r)}function Sr(){return X.getAllCategoriesWithPopularTags()}async function Ar(e,r){var t,a,l,J,S,c,T,_,E,F,A,W,$,x;try{const n={};r&&(n.Authorization=`Bearer ${r}`);const i=await sr.post(`${yr}/api/v1/characters/import`,e,{headers:n});if(i.status===201||i.status===200)return console.log("角色导入成功:",i.data),i.data;throw console.error(`角色导入失败 (status ${i.status}):`,i.data),new Error(`导入失败，状态码: ${i.status}, 详情: ${JSON.stringify(i.data)}`)}catch(n){console.error("角色导入 API 调用出错:",n);let i="导入角色时发生未知错误。",I=null;if(sr.isAxiosError(n)){if(console.error("Axios error details:",{message:n.message,responseStatus:(t=n.response)==null?void 0:t.status,responseData:(a=n.response)==null?void 0:a.data}),I=(l=n.response)==null?void 0:l.data,i=((S=(J=n.response)==null?void 0:J.data)==null?void 0:S.message)||n.message||"网络请求错误",(_=(T=(c=n.response)==null?void 0:c.data)==null?void 0:T.message)!=null&&_.includes("bucket does not exist"))console.error((F=(E=n.response)==null?void 0:E.data)==null?void 0:F.message);else if(((A=n.response)==null?void 0:A.status)===401)i="认证失败，请检查Token或重新登录。";else if(((W=n.response)==null?void 0:W.status)===400){const O=(x=($=n.response)==null?void 0:$.data)==null?void 0:x.message;Array.isArray(O)?i=`请求参数错误: ${O.join(", ")}`:i=`请求参数错误: ${O||"请检查提交的数据"}`}}else i=n.message||"发生未知错误";const p=new Error(i);throw p.originalError=n,p.data=I,p.isOperational=!0,p}}export{Cr as a,Sr as g,Ar as i,mr as s,br as u};
