import{j as e}from"./index-D55vL5wO.js";import{r as o,m as ie,u as oe}from"./react-Dz_Dwpfc.js";import{g as ce,a as de,b as xe,c as he,d as me,e as ue}from"./admin-BD4B5Hsq.js";import{F as d,m as $,c as j,a as z,B as p,x as B,q as g,y as pe,z as je,P as ge,j as O,S as T,r as U,I as W,s as u,w as b,R as ye,b as A,G as R,H as fe,J as Ie,K as be,e as q,T as H,N as K,o as J}from"./antd-CXRY_8Ve.js";import"./echarts-C9Czxobr.js";import"./sdk-service-vZjot6Jx.js";import"./admin-service-nUOkyd0V.js";function V(){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let x=0;x<6;x++)s+=r.charAt(Math.floor(Math.random()*r.length));return s}const we=({userId:r})=>{const[s,x]=o.useState(null),[l,y]=o.useState(!1),[w,h]=o.useState(!1),[S,c]=o.useState(!1),[n,f]=o.useState(!1),[E]=d.useForm(),[P]=d.useForm(),[F,Y]=o.useState([]),[Q,M]=o.useState(!1),[D,X]=o.useState(1),[k]=o.useState(10),[Z,_]=o.useState(0),ee=[{title:"资产类型ID",dataIndex:"assetTypeId",key:"assetTypeId",width:"25%",render:t=>e.jsx(b,{color:"blue",children:t.length>6?`${t.substring(0,6)}...`:t})},{title:"资产代码",dataIndex:"code",key:"code",width:"15%",render:t=>e.jsx(b,{color:"green",children:t})},{title:"可用余额",dataIndex:"balance",key:"balance",render:t=>t.toLocaleString()},{title:"冻结余额",dataIndex:"frozenBalance",key:"frozenBalance",render:t=>t.toLocaleString()},{title:"总余额",dataIndex:"totalBalance",key:"totalBalance",render:t=>e.jsx("span",{className:"font-semibold text-blue-600",children:t.toLocaleString()})}],te=[{title:"交易ID",dataIndex:"id",key:"id",width:"15%",ellipsis:!0},{title:"唯一标识",dataIndex:"uniqueId",key:"uniqueId",width:"10%",ellipsis:!0},{title:"资产类型",dataIndex:"assetTypeId",key:"assetTypeId",width:"12%",render:t=>e.jsx(b,{color:"blue",children:t.length>6?`${t.substring(0,6)}...`:t})},{title:"交易金额",dataIndex:"amount",key:"amount",width:"10%",render:t=>{const a=Number.parseFloat(t);return e.jsx("span",{className:a>=0?"text-green-600":"text-red-600",children:a.toLocaleString()})}},{title:"交易类型",dataIndex:"type",key:"type",width:"10%",render:t=>{let a="default",i=t;switch(t){case"DEPOSIT":a="green",i="充值";break;case"WITHDRAW":a="red",i="提现";break;case"TRANSFER":a="blue",i="转账";break;case"PAYMENT":a="orange",i="支付";break;case"REFUND":a="cyan",i="退款";break;case"COMMISSION":a="purple",i="佣金";break}return e.jsx(b,{color:a,children:i})}},{title:"状态",dataIndex:"status",key:"status",width:"10%",render:t=>{let a="default",i=t;switch(t){case"COMPLETED":a="green",i="完成";break;case"PENDING":a="orange",i="待处理";break;case"FAILED":a="red",i="失败";break;case"PROCESSING":a="blue",i="处理中";break}return e.jsx(b,{color:a,children:i})}},{title:"原因",dataIndex:"reason",key:"reason",width:"15%",ellipsis:!0},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:"15%",render:t=>new Date(t).toLocaleString()}],v=async()=>{if(r){y(!0);try{const t=await ce(r);x(t),console.log(`成功获取用户 ${r} 的钱包信息:`,t),t.assets&&t.assets.length>0&&console.log("资产数据示例:",t.assets[0])}catch(t){console.error(`获取用户 ${r} 钱包失败:`,t),u.error("获取钱包信息失败，请稍后重试")}finally{y(!1)}}},N=async(t=1,a=10)=>{if(r){M(!0);try{const m=await de(r,t,a),I=m&&m.items?m.items:[];Y(I);const C=m&&m.total?m.total:0;_(C),console.log(`成功获取用户 ${r} 的交易记录:`,I)}catch(i){console.error(`获取用户 ${r} 交易记录失败:`,i),u.error("获取交易记录失败，请稍后重试")}finally{M(!1)}}},se=(t,a)=>{X(t),N(t,a||k)},ae=t=>{E.resetFields(),h(!0)},ne=t=>{P.resetFields(),c(!0)},re=async t=>{f(!0);try{const a=V();await xe(r,t.assetTypeId,t.amount,a,t.reason,{operator:"admin",timestamp:new Date().toISOString()}),u.success("充值操作成功"),h(!1),v()}catch(a){console.error("充值操作失败:",a),u.error("充值操作失败，请稍后重试")}finally{f(!1)}},le=async t=>{f(!0);try{const a=V();await he(r,t.assetTypeId,t.amount,a,t.reason,{operator:"admin",timestamp:new Date().toISOString()}),u.success("提现操作成功"),c(!1),v()}catch(a){console.error("提现操作失败:",a),u.error("提现操作失败，请稍后重试")}finally{f(!1)}};return o.useEffect(()=>{v(),N(D,k)},[r]),e.jsxs("div",{className:"mt-4",children:[l?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{tip:"正在加载钱包数据..."})}):s?e.jsxs("div",{children:[e.jsxs(j,{title:"钱包信息",className:"mb-6",extra:e.jsxs(z,{children:[e.jsxs("span",{children:["创建时间:",new Date(s.createdAt).toLocaleString()]}),e.jsx(p,{icon:e.jsx(B,{}),onClick:v,size:"small",children:"刷新"})]}),children:[e.jsxs("p",{children:[e.jsx("strong",{children:"钱包ID:"})," "," "," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"更新时间:"})," "," "," ",new Date(s.updatedAt).toLocaleString()]})]}),e.jsx(j,{title:"资产明细",extra:e.jsxs(z,{children:[e.jsx(p,{type:"primary",icon:e.jsx(pe,{}),onClick:()=>ae(),children:"添加资金"}),e.jsx(p,{danger:!0,icon:e.jsx(je,{}),onClick:()=>ne(),children:"提取资金"})]}),children:e.jsx(g,{dataSource:s.assets,columns:ee,rowKey:"assetTypeId",pagination:!1,summary:t=>{if(t.length===0)return null;let a=0;return t.forEach(({totalBalance:i})=>{a+=i}),e.jsxs(g.Summary.Row,{children:[e.jsx(g.Summary.Cell,{index:0,colSpan:4,children:e.jsx("strong",{children:"总资产价值"})}),e.jsx(g.Summary.Cell,{index:1,children:e.jsx("span",{className:"text-lg font-bold text-green-600",children:a.toLocaleString()})})]})}})}),e.jsxs(j,{title:"交易历史记录",className:"mt-6",extra:e.jsx(p,{icon:e.jsx(B,{}),onClick:()=>N(D,k),size:"small",children:"刷新"}),children:[e.jsx(g,{dataSource:F||[],columns:te,rowKey:"id",loading:Q,pagination:!1,scroll:{x:1e3},locale:{emptyText:"暂无交易记录"}}),F.length>0&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ge,{current:D,pageSize:k,total:Z,onChange:se,showSizeChanger:!1,showTotal:t=>`共 ${t} 条记录`})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{children:"暂无钱包数据，请点击加载按钮"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",onClick:v,type:"button",children:"加载钱包数据"})]}),e.jsx(O,{title:"充值操作",open:w,onCancel:()=>h(!1),footer:null,maskClosable:!1,children:e.jsxs(d,{form:E,layout:"vertical",onFinish:re,children:[e.jsx(d.Item,{name:"assetTypeId",label:"资产类型ID",rules:[{required:!0,message:"请选择资产类型"}],children:e.jsx(T,{placeholder:"请选择资产类型",children:s==null?void 0:s.assets.map(t=>e.jsxs(T.Option,{value:t.assetTypeId,children:[t.code," ","-",t.assetTypeId]},t.assetTypeId))})}),e.jsx(d.Item,{name:"amount",label:"充值金额",rules:[{required:!0,message:"请输入充值金额"},{type:"number",min:.01,message:"金额必须大于0"}],children:e.jsx(U,{style:{width:"100%"},placeholder:"请输入充值金额",precision:2,min:.01})}),e.jsx(d.Item,{name:"reason",label:"充值原因",children:e.jsx(W.TextArea,{placeholder:"请输入充值原因（可选）",autoSize:{minRows:2,maxRows:4}})}),e.jsx(d.Item,{children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(p,{onClick:()=>h(!1),style:{marginRight:8},children:"取消"}),e.jsx(p,{type:"primary",htmlType:"submit",loading:n,children:"确认充值"})]})})]})}),e.jsx(O,{title:"提现操作",open:S,onCancel:()=>c(!1),footer:null,maskClosable:!1,children:e.jsxs(d,{form:P,layout:"vertical",onFinish:le,children:[e.jsx(d.Item,{name:"assetTypeId",label:"资产类型ID",rules:[{required:!0,message:"请选择资产类型"}],children:e.jsx(T,{placeholder:"请选择资产类型",children:s==null?void 0:s.assets.map(t=>e.jsxs(T.Option,{value:t.assetTypeId,children:[t.code," ","-",t.assetTypeId," ","(可用余额:",t.balance,")"]},t.assetTypeId))})}),e.jsx(d.Item,{name:"amount",label:"提现金额",rules:[{required:!0,message:"请输入提现金额"},{type:"number",min:.01,message:"金额必须大于0"},({getFieldValue:t})=>({validator(a,i){const m=t("assetTypeId");if(!m||!i)return Promise.resolve();const I=s==null?void 0:s.assets.find(C=>C.assetTypeId===m);return I&&i>I.balance?Promise.reject(new Error(`提现金额不能超过可用余额(${I.balance})`)):Promise.resolve()}})],children:e.jsx(U,{style:{width:"100%"},placeholder:"请输入提现金额",precision:2,min:.01})}),e.jsx(d.Item,{name:"reason",label:"提现原因",children:e.jsx(W.TextArea,{placeholder:"请输入提现原因（可选）",autoSize:{minRows:2,maxRows:4}})}),e.jsx(d.Item,{children:e.jsxs("div",{className:"flex justify-end",children:[e.jsx(p,{onClick:()=>c(!1),style:{marginRight:8},children:"取消"}),e.jsx(p,{danger:!0,htmlType:"submit",loading:n,children:"确认提现"})]})})]})})]})},{Text:Se}=H,ve=({userId:r})=>{const[s,x]=o.useState(null),[l,y]=o.useState(!1),w=[{title:"用户ID",dataIndex:"id",key:"id",width:"40%",ellipsis:!0},{title:"用户名",dataIndex:"username",key:"username"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",render:n=>new Date(n).toLocaleString()}],h=[{title:"用户ID",dataIndex:"id",key:"id",width:"25%",ellipsis:!0},{title:"用户名",dataIndex:"username",key:"username"},{title:"级别",dataIndex:"level",key:"level",render:n=>e.jsx(K,{count:n,style:{backgroundColor:n===1?"#52c41a":"#1890ff"}})},{title:"贡献佣金",dataIndex:"commissionAmount",key:"commissionAmount",render:n=>e.jsx("span",{className:"text-green-600 font-medium",children:n})},{title:"消费金额",dataIndex:"spentAmount",key:"spentAmount"},{title:"注册时间",dataIndex:"createdAt",key:"createdAt",render:n=>new Date(n).toLocaleString()}],S=[{title:"邀请码",dataIndex:"code",key:"code",render:n=>e.jsx(b,{color:"purple",children:n})},{title:"总邀请人数",dataIndex:"totalInvitees",key:"totalInvitees"},{title:"今日邀请",dataIndex:"todayInvitees",key:"todayInvitees",render:n=>n>0?e.jsx(K,{count:n,style:{backgroundColor:"#52c41a"}}):0},{title:"总存款",dataIndex:"totalDeposit",key:"totalDeposit"},{title:"今日存款",dataIndex:"todayDeposit",key:"todayDeposit"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:n=>new Date(n).toLocaleString()}],c=async()=>{if(r){y(!0);try{const n=await me(r);x(n),console.log(`成功获取用户 ${r} 的邀请信息:`,n)}catch(n){console.error(`获取用户 ${r} 邀请数据失败:`,n),u.error("获取邀请数据失败，请稍后重试")}finally{y(!1)}}};return o.useEffect(()=>{c()},[r]),e.jsx("div",{className:"mt-4",children:l?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{tip:"正在加载邀请数据..."})}):s?e.jsxs("div",{children:[e.jsx(j,{title:"邀请数据摘要",className:"mb-6",children:e.jsxs(ye,{gutter:16,children:[e.jsx(A,{span:8,children:e.jsx(R,{title:"累计佣金",value:s.totalAmount,prefix:e.jsx(fe,{}),valueStyle:{color:"#3f8600"}})}),e.jsx(A,{span:8,children:e.jsx(R,{title:"直接下线数",value:s.downline.filter(n=>n.level===1).length,prefix:e.jsx(Ie,{})})}),e.jsx(A,{span:8,children:e.jsx(R,{title:"邀请码数量",value:s.invitationCodesStatistics.length,prefix:e.jsx(be,{})})})]})}),e.jsx(j,{title:"邀请码统计",className:"mb-6",children:e.jsx(g,{dataSource:s.invitationCodesStatistics,columns:S,rowKey:"code",pagination:s.invitationCodesStatistics.length>10?{pageSize:10}:!1})}),s.commissionRates&&s.commissionRates.length>0&&e.jsx(j,{title:"佣金配置",className:"mb-6",children:e.jsx(q,{bordered:!0,column:1,children:s.commissionRates.map((n,f)=>e.jsx(q.Item,{label:`等级 ${n.level}`,children:e.jsxs(Se,{strong:!0,className:"text-red-600",children:[n.rate,"%"]})},f))})}),s.upline&&s.upline.length>0&&e.jsx(j,{title:"上级用户",className:"mb-6",children:e.jsx(g,{dataSource:s.upline,columns:w,rowKey:"id",pagination:!1})}),s.downline&&s.downline.length>0&&e.jsx(j,{title:"下级用户",className:"mb-6",children:e.jsx(g,{dataSource:s.downline,columns:h,rowKey:"id",pagination:s.downline.length>10?{pageSize:10}:!1})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{children:"暂无邀请数据，请点击加载按钮"}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",onClick:c,type:"button",children:"加载邀请数据"})]})})},{Title:G}=H,{TabPane:L}=J;function Le(){const s=ie().id,x=oe(),[l,y]=o.useState(null),[w,h]=o.useState(!0);return o.useEffect(()=>{if(!s){u.error("用户ID无效"),x("/user");return}async function S(){h(!0);try{const c=await ue(s);y(c),console.log(`成功获取用户 ${s} 的信息:`,c)}catch(c){console.error(`获取用户 ${s} 详情失败:`,c),u.error("获取用户详情失败，请稍后重试")}finally{h(!1)}}S()},[s,x]),w?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx($,{size:"large",tip:"正在加载用户详情..."})}):l?e.jsxs("div",{className:"p-6",children:[e.jsxs(G,{level:3,className:"mb-6",children:["用户详情:"," ",l.username]}),e.jsxs(J,{defaultActiveKey:"basic",children:[e.jsx(L,{tab:"基本信息",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"用户ID:"})," ",l.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"用户名:"})," ",l.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"昵称:"})," ",l.nickname||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"邮箱:"})," ",l.email||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"等级:"})," ",l.level]}),e.jsxs("p",{children:[e.jsx("strong",{children:"积分:"})," ",l.points]}),e.jsxs("p",{children:[e.jsx("strong",{children:"性别:"})," ",l.gender||"-"]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"注册时间:"})," ",new Date(l.createdAt).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"最后活跃:"})," ",l.lastActiveAt?new Date(l.lastActiveAt).toLocaleString():"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"头像URL:"})," ",l.avatarUrl||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"个人简介:"})," ",l.bio||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"生日:"})," ",l.birthday||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"地区:"})," ",l.location||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"邀请码:"})," ",l.invitationCode||"-"]})]})]})},"basic"),e.jsx(L,{tab:"钱包",children:e.jsx(we,{userId:s})},"wallet"),e.jsx(L,{tab:"邀请",children:e.jsx(ve,{userId:s})},"invite")]})]}):e.jsx("div",{className:"p-6 text-center",children:e.jsx(G,{level:4,children:"无法加载用户信息"})})}export{Le as default};
