import{u as $,j as e}from"./index-DVVfHaA6.js";import{r as c}from"./react-Dz_Dwpfc.js";import{A as d}from"./admin-service-C1mpDGe1.js";import{B as K}from"./BatchDeleteButton-BJUgFdkQ.js";import{C as J}from"./CreateButton-CaLdSznb.js";import{E as Q,D as W}from"./EditButton-BikjkQ3M.js";import{S as X,a as y,b as Z,R as ee}from"./SearchRow-BOPFbCy_.js";import{S as te}from"./SearchContainer-CD2j9xKu.js";import{u as re,a as se,S as le}from"./useTable-5WC2S6dI.js";import{A as ae,F as a,w as g,I as o,S as s,a as ie,k as P,q as ne,E as S,j as T,B as u}from"./antd-DpJIrhNI.js";import"./echarts-C9Czxobr.js";import"./sdk-service-BLKJfM_e.js";import"./Button-Bn4Gp5ze.js";import"./useWindowSize-DSNN33pu.js";import"./useMutation-C2nYnVDP.js";import"./usePageTransfer-bIOoXG8A.js";function Ae(){const{t}=$(),k=c.useRef(null),{modal:O,message:i}=ae.useApp(),[w,p]=c.useState(!1),[E,h]=c.useState(!1),[m,F]=c.useState(null),[j]=a.useForm(),[f]=a.useForm(),[I,x]=c.useState(!1);c.useEffect(()=>{const r=localStorage.getItem("user.token");console.log("当前token状态:",r?"已存在":"不存在",r?`${r.substring(0,15)}...`:"")},[]);async function U({page:r,pageSize:l}){console.log("正在请求供应商列表...",{page:r,pageSize:l});try{const n=await d.getAllProviders();return console.log("供应商列表获取成功:",n),{list:n,total:n.length}}catch(n){return console.error("获取供应商列表失败:",n),n instanceof Error?i.error(`获取供应商列表失败: ${n.message}`):i.error("获取供应商列表失败: 未知错误"),{list:[],total:0}}}const{listContainerProps:R,tableScrollY:b}=re(),{form:B,tableProps:D,isLoading:L,selectedIsEmpty:V,selectedCount:M,handleReset:C}=se({key:"provider-list",pagination:!0,listApiFn:U,scrollY:b,selectable:!0,formInitialValues:{name:null,providerType:null,status:null},columns:[{title:t("供应商ID"),dataIndex:"id"},{title:t("供应商名称"),dataIndex:"name"},{title:t("描述"),dataIndex:"description",ellipsis:!0},{title:t("供应商类型"),dataIndex:"providerType",render:r=>e.jsx(g,{color:"processing",children:r})},{title:t("认证类型"),dataIndex:"authType",render:r=>e.jsx(g,{color:"blue",children:r})},{title:t("API基础URL"),dataIndex:"apiBaseUrl",ellipsis:!0},{title:t("状态"),dataIndex:"status",render:r=>e.jsx(g,{color:r==="ACTIVE"?"success":"warning",children:r})},{title:t("创建时间"),dataIndex:"createdAt",render:r=>new Date(r).toLocaleString()},{title:t("操作"),key:"actions",fixed:"right",width:120,render:(r,l)=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{type:"text",size:"small",noText:!0,onClick:()=>q(l)}),e.jsx(W,{type:"text",size:"small",noText:!0,onConfirm:()=>G(l.id)})]})}]}),v=()=>{C()};function q(r){F(r),f.setFieldsValue({name:r.name,description:r.description,websiteUrl:r.websiteUrl,apiDocUrl:r.apiDocUrl,apiBaseUrl:r.apiBaseUrl,authType:r.authType,providerType:r.providerType}),h(!0)}async function _(){if(m)try{const r=await f.validateFields();x(!0),await d.updateProvider(m.id,r),i.success(t("更新成功")),h(!1),v()}catch(r){console.error("更新供应商失败:",r),i.error(t("更新失败"))}finally{x(!1)}}async function G(r){try{await d.updateProviderStatus(r,{}),i.success(t("删除成功")),v()}catch(l){console.error("删除供应商失败:",l),i.error(t("删除失败"))}}async function z(r){try{const l=await d.checkProviderHealth(r);O.success({title:t("健康状态检查"),content:e.jsxs("div",{children:[e.jsxs("p",{children:[t("状态"),":"," ",l.message?t("健康"):t("不健康")]}),e.jsxs("p",{children:[t("消息"),":"," ",l.message||t("无详细信息")]})]})})}catch(l){console.error("检查供应商健康状态失败:",l),i.error(t("健康状态检查失败"))}}const H=e.jsx(a,{ref:k,form:B,colon:!1,autoComplete:"off",onFinish:()=>{},children:e.jsx(te,{actions:e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(Z,{loading:L}),e.jsx(ee,{onClick:C})]}),e.jsx(P,{type:"vertical"}),e.jsx(K,{disabled:V,count:M,onConfirm:()=>{}}),e.jsx(P,{type:"vertical"}),e.jsx(J,{onClick:()=>N()})]}),children:e.jsxs(X,{children:[e.jsx(y,{name:"name",label:t("供应商名称"),children:e.jsx(o,{})}),e.jsx(y,{name:"providerType",label:t("供应商类型"),children:e.jsxs(s,{allowClear:!0,children:[e.jsx(s.Option,{value:"openai",children:t("OpenAI")}),e.jsx(s.Option,{value:"anthropic",children:t("Anthropic")}),e.jsx(s.Option,{value:"cohere",children:t("Cohere")}),e.jsx(s.Option,{value:"mistralai",children:t("Mistral")}),e.jsx(s.Option,{value:"deepseek",children:t("Deepseek")}),e.jsx(s.Option,{value:"google",children:t("Google")}),e.jsx(s.Option,{value:"custom",children:t("自定义")})]})}),e.jsx(y,{name:"status",label:t("状态"),children:e.jsxs(s,{allowClear:!0,children:[e.jsx(s.Option,{value:"ACTIVE",children:t("活跃")}),e.jsx(s.Option,{value:"INACTIVE",children:t("不活跃")})]})})]})})});function N(){j.resetFields(),p(!0)}async function Y(){try{const r=await j.validateFields();x(!0),await d.createProvider(r),i.success(t("创建成功")),p(!1),v()}catch(r){console.error("创建供应商失败:",r),i.error(t("创建失败"))}finally{x(!1)}}const A=(r,l=!1)=>e.jsxs(a,{form:r,layout:"vertical",autoComplete:"off",children:[e.jsx(a.Item,{name:"name",label:t("供应商名称"),rules:[{required:!0,message:t("请输入供应商名称")}],children:e.jsx(o,{placeholder:t("请输入供应商名称")})}),e.jsx(a.Item,{name:"description",label:t("供应商描述"),children:e.jsx(o.TextArea,{placeholder:t("请输入供应商描述")})}),e.jsx(a.Item,{name:"websiteUrl",label:t("官网URL"),children:e.jsx(o,{placeholder:t("请输入官网URL")})}),e.jsx(a.Item,{name:"apiDocUrl",label:t("API文档URL"),children:e.jsx(o,{placeholder:t("请输入API文档URL")})}),e.jsx(a.Item,{name:"apiKey",label:t("API密钥"),rules:[{required:!l,message:t("请输入API密钥")}],children:e.jsx(o.Password,{placeholder:t(l?"留空表示不修改":"请输入API密钥")})}),e.jsx(a.Item,{name:"apiBaseUrl",label:t("API基础URL"),children:e.jsx(o,{placeholder:t("请输入API基础URL")})}),e.jsx(a.Item,{name:"authType",label:t("认证类型"),rules:[{required:!0,message:t("请选择认证类型")}],initialValue:"api_key",children:e.jsxs(s,{children:[e.jsx(s.Option,{value:"api_key",children:t("API密钥")}),e.jsx(s.Option,{value:"oauth",children:t("OAuth")}),e.jsx(s.Option,{value:"custom",children:t("自定义")})]})}),e.jsx(a.Item,{name:"providerType",label:t("供应商类型"),rules:[{required:!0,message:t("请选择供应商类型")}],initialValue:"custom",children:e.jsxs(s,{children:[e.jsx(s.Option,{value:"openai",children:t("OpenAI")}),e.jsx(s.Option,{value:"anthropic",children:t("Anthropic")}),e.jsx(s.Option,{value:"cohere",children:t("Cohere")}),e.jsx(s.Option,{value:"mistralai",children:t("Mistral")}),e.jsx(s.Option,{value:"deepseek",children:t("Deepseek")}),e.jsx(s.Option,{value:"google",children:t("Google")}),e.jsx(s.Option,{value:"custom",children:t("自定义")})]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(le,{...R,searchForm:H,children:e.jsx(ne,{...D,locale:{emptyText:e.jsx(S,{description:t("暂无供应商数据"),image:S.PRESENTED_IMAGE_SIMPLE})},scroll:{x:1500,y:b}})}),e.jsx(T,{title:t("创建供应商"),open:w,onCancel:()=>p(!1),footer:[e.jsx(u,{onClick:()=>p(!1),children:t("取消")},"cancel"),e.jsx(u,{type:"primary",loading:I,onClick:Y,children:t("确定")},"submit")],width:600,children:A(j)}),e.jsx(T,{title:t("编辑供应商"),open:E,onCancel:()=>h(!1),footer:[e.jsx(u,{onClick:()=>h(!1),children:t("取消")},"cancel"),e.jsx(u,{type:"primary",loading:I,onClick:_,children:t("确定")},"submit"),e.jsx(u,{type:"default",onClick:()=>m&&z(m.id),children:t("检查健康状态")},"health")],width:600,children:A(f,!0)})]})}export{Ae as default};
