import{j as e}from"./index-7HAhTflM.js";import{e as T,u as M,r as f}from"./react-DR1zDSRy.js";import{W as u}from"./worldinfo-service-CmxxHIRV.js";import{F as n,M as D,I as p,R as y,a,d as V,l as m,T as P,B as k,h as R,C as v,c as O,s as d,e as $,S as B,y as _,H as q}from"./antd-C5ilffvX.js";import"./echarts-C5AzJBXJ.js";const{Option:h}=V,G=({visible:o,onCancel:s,onOk:N,initialValues:l,title:b})=>{const[c]=n.useForm(),w=()=>{c.validateFields().then(t=>{c.resetFields(),N(t)}).catch(t=>{console.log("Validate Failed:",t)})};return e.jsxDEV(D,{open:o,title:b,onCancel:s,onOk:w,width:800,destroyOnClose:!0,children:e.jsxDEV(n,{form:c,layout:"vertical",initialValues:l||{selective:!0,priority:100,constant:!1,disable:!1,caseSensitive:!1,searchRange:"Global",regex:!1,groupScore:"None",automationId:""},children:[e.jsxDEV(n.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:e.jsxDEV(p,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:45,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:44,columnNumber:9},void 0),e.jsxDEV(n.Item,{name:"keys",label:"主要关键字 (逗号分隔)",rules:[{required:!0,message:"请输入关键字"}],children:e.jsxDEV(p,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:48,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:47,columnNumber:9},void 0),e.jsxDEV(y,{gutter:16,children:[e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"searchRange",label:"扫描深度",children:e.jsxDEV(V,{children:[e.jsxDEV(h,{value:"Global",children:"使用全局设置"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:54,columnNumber:25},void 0),e.jsxDEV(h,{value:"Character",children:"角色定义"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:55,columnNumber:25},void 0),e.jsxDEV(h,{value:"Memory",children:"记忆"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:56,columnNumber:25},void 0),e.jsxDEV(h,{value:"ChatHistory",children:"聊天记录"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:57,columnNumber:25},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:53,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:52,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:51,columnNumber:13},void 0),e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"caseSensitive",label:"区分大小写",valuePropName:"checked",children:e.jsxDEV(m,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:63,columnNumber:22},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:62,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:61,columnNumber:14},void 0),e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"regex",label:"Whole Words",valuePropName:"checked",children:e.jsxDEV(m,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:68,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:67,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:66,columnNumber:14},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:50,columnNumber:9},void 0),e.jsxDEV(n.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:e.jsxDEV(p.TextArea,{rows:6},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:73,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:72,columnNumber:9},void 0),e.jsxDEV(y,{gutter:16,children:[e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"disable",valuePropName:"checked",children:e.jsxDEV(m,{children:"不可递归"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:78,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:77,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:76,columnNumber:11},void 0),e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"prevent_recursion",valuePropName:"checked",children:e.jsxDEV(m,{children:"防止进一步递归"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:83,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:82,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:81,columnNumber:11},void 0),e.jsxDEV(a,{span:8,children:e.jsxDEV(n.Item,{name:"delay_recursion",valuePropName:"checked",children:e.jsxDEV(m,{children:"延迟到递归"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:88,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:87,columnNumber:14},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:86,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:75,columnNumber:9},void 0),e.jsxDEV(y,{gutter:16,children:[e.jsxDEV(a,{span:6,children:e.jsxDEV(n.Item,{label:"确定优先极",children:e.jsxDEV(m,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:95,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:94,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:93,columnNumber:13},void 0),e.jsxDEV(a,{span:6,children:e.jsxDEV(n.Item,{name:"priority",label:"组权重",children:e.jsxDEV(P,{style:{width:"100%"}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:100,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:99,columnNumber:18},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:98,columnNumber:13},void 0),e.jsxDEV(a,{span:6,children:e.jsxDEV(n.Item,{label:"黏性",children:e.jsxDEV(m,{children:"无黏性"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:105,columnNumber:22},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:104,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:103,columnNumber:13},void 0),e.jsxDEV(a,{span:6,children:e.jsxDEV(n.Item,{label:"排除",children:e.jsxDEV(m,{children:"排除"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:110,columnNumber:22},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:109,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:108,columnNumber:14},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:92,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:39,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/components/WorldInfoEntryForm.tsx",lineNumber:31,columnNumber:5},void 0)},{Title:H}=R,Q=()=>{const{id:o}=T(),s=M(),[N]=n.useForm(),[l,b]=f.useState(null),[c,w]=f.useState([]),[t,g]=f.useState(!0),[I,E]=f.useState(!1),x=async()=>{if(o){g(!0);try{const[r,i]=await Promise.all([u.getWorldInfoById(o),u.getWorldInfoEntries(o)]);b(r),N.setFieldsValue({name:r.name,description:r.description}),w(i)}catch{d.error("Failed to fetch world info details.")}finally{g(!1)}}};f.useEffect(()=>{x()},[o]);const j=async r=>{if(!(!o||!l))try{const i={...r,type:l.type};await u.updateWorldInfo(o,i),d.success("World info updated successfully!")}catch{d.error("Failed to update world info.")}},W=()=>{E(!0)},F=r=>{o&&D.confirm({title:"Are you sure you want to delete this entry?",onOk:async()=>{try{await u.deleteWorldInfoEntry(o,r),d.success("Entry deleted successfully"),x()}catch{d.error("Failed to delete entry")}}})},C=async r=>{if(o)try{await u.createWorldInfoEntry(o,r),d.success("Entry created successfully"),E(!1),x()}catch{d.error("Failed to create entry.")}},S=[{title:"ID",dataIndex:"id",key:"id",width:280,ellipsis:!0,render:(r,i)=>e.jsxDEV("a",{onClick:()=>s(`/worldinfo/${o}/${i.id}`),children:r},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:100,columnNumber:5},void 0)},{title:"Keywords",dataIndex:"keys",key:"keys",render:r=>Array.isArray(r)?r.join(", "):""},{title:"备忘",dataIndex:"comment",key:"comment",ellipsis:!0},{title:"插入位置",dataIndex:"position",key:"position",render:r=>r==="before_char"?"角色定义之前":r==="after_char"?"角色定义之后":r},{title:"深度",dataIndex:"scanDepth",key:"scanDepth"},{title:"顺序",dataIndex:"order",key:"order"},{title:"触发概率",dataIndex:"probability",key:"probability",render:r=>`${r??100}%`},{title:"启用状态",dataIndex:"enabled",key:"enabled",render:(r,i)=>e.jsxDEV($,{checked:r,checkedChildren:"启用",unCheckedChildren:"禁用",onChange:async A=>{try{await u.updateWorldInfoEntry(o,i.id,{enabled:A}),d.success("状态更新成功"),x()}catch{d.error("状态更新失败")}}},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:125,columnNumber:5},void 0)},{title:"Action",key:"action",render:(r,i)=>e.jsxDEV(B,{size:"middle",children:[e.jsxDEV(_,{style:{cursor:"pointer"},onClick:()=>s(`/worldinfo/${o}/${i.id}`)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:146,columnNumber:21},void 0),e.jsxDEV(q,{style:{color:"red",cursor:"pointer"},onClick:()=>F(i.id)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:147,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:145,columnNumber:5},void 0)}];return e.jsxDEV("div",{children:[e.jsxDEV("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"},children:[e.jsxDEV(k,{onClick:()=>s("/worldinfo"),style:{marginRight:"16px"},children:"Back"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:156,columnNumber:17},void 0),e.jsxDEV(H,{level:4,style:{marginBottom:0},children:l?`Edit World Info: ${l.name}`:"Edit World Info"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:159,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:155,columnNumber:13},void 0),e.jsxDEV(v,{title:"Details",loading:t,children:e.jsxDEV(n,{form:N,layout:"vertical",onFinish:j,children:[e.jsxDEV(n.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsxDEV(p,{},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:166,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:165,columnNumber:21},void 0),e.jsxDEV(n.Item,{name:"description",label:"Description",children:e.jsxDEV(p.TextArea,{rows:4},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:169,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:168,columnNumber:21},void 0),e.jsxDEV(n.Item,{children:e.jsxDEV(k,{type:"primary",htmlType:"submit",children:"Save Changes"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:172,columnNumber:25},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:171,columnNumber:21},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:164,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:163,columnNumber:13},void 0),e.jsxDEV(v,{title:"Entries",style:{marginTop:16},extra:e.jsxDEV(k,{type:"primary",onClick:W,children:"Add Entry"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:182,columnNumber:16},void 0),children:e.jsxDEV(O,{columns:S,dataSource:c,rowKey:"id",loading:t},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:184,columnNumber:17},void 0)},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:179,columnNumber:13},void 0),I&&e.jsxDEV(G,{visible:I,onCancel:()=>E(!1),onOk:C,initialValues:null,title:"Add Entry"},void 0,!1,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:193,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/pure-admin-react/pure-admin-react/src/pages/worldinfo/[id]/index.tsx",lineNumber:154,columnNumber:5},void 0)};export{Q as default};
